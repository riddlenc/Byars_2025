---
title: "daily_activity_analysis"
output:
  word_document: default
  html_document: default
date: "2024-06-04"
---

#Load the library
```{r}
library(readxl)
library(reshape2)
library(ggplot2)
library(reshape)
library(dplyr)
library(here)
library(ARTool)
```

#Clear workspace
```{r}
rm(list = ls())
```

#check working directory
```{r}
getwd()
```


---

#DGRP852 genotype data to run:
loading data frames for DAM data
set file name
```{r}
DAM_852 <- "DAM_852_2023_04_17.xlsx"
```

#Steps to load and organize all the data for the t0 timepoint
load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t0_c_852 <- read_excel(DAM_852, sheet = "t0_c_norm")
  t0_5d_852 <- read_excel(DAM_852, sheet = "t0_5d_norm")
```
#load the legend specific to the timepoint t0
```{r}
  legend_t0_852 <- read_excel(DAM_852, sheet = "legend_t0")
  legend_t0_852$chan_no <- as.factor(legend_t0_852$chan_no)
```
#break the legend out by treatment in order to do a left join 
```{r}
  legend_c_852 <- subset(legend_t0_852, treatment == "c")
  legend_5d_852 <- subset(legend_t0_852, treatment== "5d")
```
#convert to data frame
```{r}
  t0_c_852 <- as.data.frame(t0_c_852)
  t0_5d_852 <- as.data.frame(t0_5d_852)
```
#use the melt function to convert to long format
```{r}
  t0_c_852 <- melt(t0_c_852, id.vars = c("index", "date", "time"), 
             measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                              "9", "10", "11", "12", "13", "14", "15",
                              "16", "17", "18", "19", "20", "21", "22",
                              "24", "25", "26", "27", "28", "29", 
                              "30", "31", "32"))
  t0_5d_852 <- melt(t0_5d_852, id.vars = c("index", "date", "time"), 
              measure.vars = c("1", "2","3", "4", "5", "6", "7", "8",
                               "9", "10", "11", "12", "14", "15", "16",
                               "17", "18", "19", "21", "22", "23", "24",
                              "25"))
```

#sanity check 1
```{r}
  summary(t0_c_852)
  summary(t0_5d_852)
```

#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t0_c_852 <- aggregate(t0_c_852$value, by=list(chan_no=t0_c_852$variable), FUN=sum)
  t0_5d_852 <- aggregate(t0_5d_852$value, by=list(chan_no=t0_5d_852$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t0_c_852) <- c("chan_no", "daily_activity")
  colnames(t0_5d_852) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t0_c_852 <- left_join(t0_c_852, legend_c_852, by = "chan_no")
  t0_5d_852 <- left_join(t0_5d_852, legend_5d_852, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
    t0_c_852 <- t0_c_852[keeps]
    t0_5d_852 <- t0_5d_852[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t0_852 <- rbind(t0_c_852, t0_5d_852)
```
#sanity check 2
```{r}
  summary(master_t0_852)

  hist(master_t0_852$daily_activity)
  abline(v = mean(master_t0_852$daily_activity), col="red", lwd=3)
```


---
#Steps to load and organize all the data for the t1 timepoint
load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t1_c_852 <- read_excel(DAM_852, sheet = "t1_c_norm")
  t1_5d_852 <- read_excel(DAM_852, sheet = "t1_5d_norm")
  t1_20d_852 <- read_excel(DAM_852, sheet = "t1_20d_norm")
```
#load the legend specific to the timepoint t1
```{r}
  legend_t1_t2_852 <- read_excel(DAM_852, sheet = "legend_t1")
  legend_t1_t2_852$chan_no <- as.factor(legend_t1_t2_852$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_852 <- subset(legend_t1_t2_852, treatment == "c")
  legend_5d_852 <- subset(legend_t1_t2_852, treatment== "5d")
  legend_20d_852 <- subset(legend_t1_t2_852, treatment== "20d")
```
#convert to data frame
```{r}
  t1_c_852 <- as.data.frame(t1_c_852)
  t1_5d_852 <- as.data.frame(t1_5d_852)
  t1_20d_852 <- as.data.frame(t1_20d_852)
```
#use the melt function to convert to long format
```{r}
  t1_c_852 <- melt(t1_c_852, id.vars = c("index", "date", "time"), 
               measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                "9", "10", "11", "12", "13", "14", "15",
                                "16", "17", "18", "19", "20", "21", "22",
                                "23", "24", "25", "26", "27", "28", "29", 
                                "30", "31"))
  t1_5d_852 <- melt(t1_5d_852, id.vars = c("index", "date", "time"), 
                measure.vars = c("1", "2","3", "4", "5", "6", "7", "8",
                                 "9", "10", "11", "12", "13", "14", "15",
                                 "16", "17", "18", "19", "20", "21", "22",
                                 "23"))
  t1_20d_852 <- melt(t1_20d_852, id.vars = c("index", "date", "time"), 
                 measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                  "9", "10", "11", "12", "13", "14", "15",
                                  "16", "17", "18", "19", "20", "21", "22",
                                  "23", "24", "25"))
```
#sanity check 1
```{r}
  summary(t1_c_852)
  summary(t1_5d_852)
  summary(t1_20d_852)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t1_c_852 <- aggregate(t1_c_852$value, by=list(chan_no=t1_c_852$variable), FUN=sum)
  t1_5d_852 <- aggregate(t1_5d_852$value, by=list(chan_no=t1_5d_852$variable), FUN=sum)
  t1_20d_852 <- aggregate(t1_20d_852$value, by=list(chan_no=t1_20d_852$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t1_c_852) <- c("chan_no", "daily_activity")
  colnames(t1_5d_852) <- c("chan_no", "daily_activity")
  colnames(t1_20d_852) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t1_c_852 <- left_join(t1_c_852, legend_c_852, by = "chan_no")
  t1_5d_852 <- left_join(t1_5d_852, legend_5d_852, by = "chan_no")
  t1_20d_852 <- left_join(t1_20d_852, legend_20d_852, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
    t1_c_852 <- t1_c_852[keeps]
    t1_5d_852 <- t1_5d_852[keeps]
    t1_20d_852 <- t1_20d_852[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t1_852 <- rbind(t1_c_852, t1_5d_852, t1_20d_852)
```
#sanity check 2
```{r}
  summary(master_t1_852)

  hist(master_t1_852$daily_activity)
  abline(v = mean(master_t1_852$daily_activity), col="red", lwd=3)
```


---
#Steps to load and organize all the data for the t2 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t2_c_852 <- read_excel(DAM_852, sheet = "t2_c_norm")
  t2_5d_852 <- read_excel(DAM_852, sheet = "t2_5d_norm")
  t2_20d_852 <- read_excel(DAM_852, sheet = "t2_20d_norm")
```
#load the legend specific to the timepoint t1_t2
```{r}
  legend_t1_t2_852 <- read_excel(DAM_852, sheet = "legend_t2")
  legend_t1_t2_852$chan_no <- as.factor(legend_t1_t2_852$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_852 <- subset(legend_t1_t2_852, treatment == "c")
  legend_5d_852 <- subset(legend_t1_t2_852, treatment== "5d")
  legend_20d_852 <- subset(legend_t1_t2_852, treatment== "20d")
```
#convert to data frame
```{r}
  t2_c_852 <- as.data.frame(t2_c_852)
  t2_5d_852 <- as.data.frame(t2_5d_852)
  t2_20d_852 <- as.data.frame(t2_20d_852)
```
#use the melt function to convert to long format
```{r}
  t2_c_852 <- melt(t2_c_852, id.vars = c("index", "date", "time"), 
               measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                "9", "10", "11", "12", "13", "14", "15",
                                "16", "17", "18", "19", "20", "21", "22",
                                "23", "24", "25", "26", "27", "28", "29", 
                                "30", "31"))
  t2_5d_852 <- melt(t2_5d_852, id.vars = c("index", "date", "time"), 
                measure.vars = c("1", "2","3", "4", "5", "6", "7", "8",
                                 "9", "10", "11", "12", "13", "14", "15",
                                 "16", "17", "18", "19", "20", "21", "22",
                                 "23"))
  t2_20d_852 <- melt(t2_20d_852, id.vars = c("index", "date", "time"), 
                 measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                  "9", "10", "11", "12", "13", "14", "15",
                                  "16", "17", "18", "19", "20", "21", "22",
                                  "23", "24", "25"))
```
#sanity check 1
```{r}
  summary(t2_c_852)
  summary(t2_5d_852)
  summary(t2_20d_852)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t2_c_852 <- aggregate(t2_c_852$value, by=list(chan_no=t2_c_852$variable), FUN=sum)
  t2_5d_852 <- aggregate(t2_5d_852$value, by=list(chan_no=t2_5d_852$variable), FUN=sum)
  t2_20d_852 <- aggregate(t2_20d_852$value, by=list(chan_no=t2_20d_852$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t2_c_852) <- c("chan_no", "daily_activity")
  colnames(t2_5d_852) <- c("chan_no", "daily_activity")
  colnames(t2_20d_852) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t2_c_852 <- left_join(t2_c_852, legend_c_852, by = "chan_no")
  t2_5d_852 <- left_join(t2_5d_852, legend_5d_852, by = "chan_no")
  t2_20d_852 <- left_join(t2_20d_852, legend_20d_852, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t2_c_852 <- t2_c_852[keeps]
  t2_5d_852 <- t2_5d_852[keeps]
  t2_20d_852 <- t2_20d_852[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t2_852 <- rbind(t2_c_852, t2_5d_852, t2_20d_852)
```

#sanity check 2
```{r}
  summary(master_t2_852)

  hist(master_t2_852$daily_activity)
  abline(v = mean(master_t2_852$daily_activity), col="red", lwd=3)
```


timepoint 3 does not exist for DGRP852, it was removed due to the DAMs repeating values






---

#DGRP786 genotype data to run:
loading data frames for DAM data
set file name
```{r}
DAM_786 <- "DAM_786_2023_11_06.xlsx"
```
#Steps to load and organize all the data for the t0 timepoint
load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t0_c_786 <- read_excel(DAM_786, sheet = "t0_c_norm")
  t0_5d_786 <- read_excel(DAM_786, sheet = "t0_5d_norm")
```
#load the legend specific to the timepoint t0
```{r}
  legend_786 <- read_excel(DAM_786, sheet = "legend_t0")
  legend_786$chan_no <- as.factor(legend_786$chan_no)
```
#break the legend out by treatment in order to do a left join 
```{r}
  legend_c_786 <- subset(legend_786, treatment == "c")
  legend_5d_786 <- subset(legend_786, treatment== "5d")
```
#convert to data frame
```{r}
  t0_c_786 <- as.data.frame(t0_c_786)
  t0_5d_786 <- as.data.frame(t0_5d_786)
```
#use the melt function to convert to long format
```{r}
  t0_c_786 <- melt(t0_c_786, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                    "9", "10", "11", "12", "13", "14", "15",
                                    "16", "17", "18", "19", "20", "21", "22",
                                    "23", "24", "25", "26", "27", "28", "29",
                                    "30", "31", "32"))
  t0_5d_786 <- melt(t0_5d_786, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12", "13", "14", "15",
                                     "16", "17", "18", "19", "20", "21", "22",
                                     "23", "24", "25", "26", "27", "28", "29",
                                     "30", "31", "32"))
```
#sanity check 1
```{r}
  summary(t0_c_786)
  summary(t0_5d_786)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t0_c_786 <- aggregate(t0_c_786$value, by=list(chan_no=t0_c_786$variable), FUN=sum)
  t0_5d_786 <- aggregate(t0_5d_786$value, by=list(chan_no=t0_5d_786$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t0_c_786) <- c("chan_no", "daily_activity")
  colnames(t0_5d_786) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t0_c_786 <- left_join(t0_c_786, legend_c_786, by = "chan_no")
  t0_5d_786 <- left_join(t0_5d_786, legend_5d_786, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t0_c_786 <- t0_c_786[keeps]
  t0_5d_786 <- t0_5d_786[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t0_786 <- rbind(t0_c_786, t0_5d_786)
```
#sanity check 2
```{r}
  summary(master_t0_786)

  hist(master_t0_786$daily_activity)
  abline(v = mean(master_t0_786$daily_activity), col="red", lwd=3)
```


---
#Steps to load and organize all the data for the t1 timepoint
load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t1_c_786 <- read_excel(DAM_786, sheet = "t1_c_norm")
  t1_5d_786 <- read_excel(DAM_786, sheet = "t1_5d_norm")
  t1_20d_786 <- read_excel(DAM_786, sheet = "t1_20d_norm")
```
#load the legend specific to the timepoint
```{r}
  legend_786 <- read_excel(DAM_786, sheet = "legend_t1")
  legend_786$chan_no <- as.factor(legend_786$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_786 <- subset(legend_786, treatment == "c")
  legend_5d_786 <- subset(legend_786, treatment== "5d")
  legend_20d_786 <- subset(legend_786, treatment== "20d")
```
#convert to data frame
```{r}
  t1_c_786 <- as.data.frame(t1_c_786)
  t1_5d_786 <- as.data.frame(t1_5d_786)
  t1_20d_786 <- as.data.frame(t1_20d_786)
```
#use the melt function to convert to long format
```{r}
  t1_c_786 <- melt(t1_c_786, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                    "9", "10", "11", "12", "13", "14", "15",
                                    "16", "17", "18", "19", "20", "21", "22",
                                    "23", "24", "25", "26", "27", "28", "29",
                                    "30", "31", "32"))
  t1_5d_786 <- melt(t1_5d_786, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12", "13", "14", "15",
                                     "16", "17", "18", "19", "20", "21", "22",
                                     "23", "24", "25", "26", "27", "28", "29",
                                     "30", "31", "32"))
  t1_20d_786 <- melt(t1_20d_786, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                      "9", "11", "12", "13", "14", "15",
                                      "16", "17", "18", "19", "20", "21", "22",
                                      "23", "24", "25", "26", "27", "28", "29",
                                      "30", "31", "32"))
```
#sanity check 1
```{r}
 summary(t1_c_786)
  summary(t1_5d_786)
  summary(t1_20d_786)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t1_c_786 <- aggregate(t1_c_786$value, by=list(chan_no=t1_c_786$variable), FUN=sum)
  t1_5d_786 <- aggregate(t1_5d_786$value, by=list(chan_no=t1_5d_786$variable), FUN=sum)
  t1_20d_786 <- aggregate(t1_20d_786$value, by=list(chan_no=t1_20d_786$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t1_c_786) <- c("chan_no", "daily_activity")
  colnames(t1_5d_786) <- c("chan_no", "daily_activity")
  colnames(t1_20d_786) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t1_c_786 <- left_join(t1_c_786, legend_c_786, by = "chan_no")
  t1_5d_786 <- left_join(t1_5d_786, legend_5d_786, by = "chan_no")
  t1_20d_786 <- left_join(t1_20d_786, legend_20d_786, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t1_c_786 <- t1_c_786[keeps]
  t1_5d_786 <- t1_5d_786[keeps]
  t1_20d_786 <- t1_20d_786[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t1_786 <- rbind(t1_c_786, t1_5d_786, t1_20d_786)
```
#sanity check 2
```{r}
  summary(master_t1_786)

  hist(master_t1_786$daily_activity)
  abline(v = mean(master_t1_786$daily_activity), col="red", lwd=3)
```


---
#Steps to load and organize all the data for the t2 timepoint
load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t2_c_786 <- read_excel(DAM_786, sheet = "t2_c_norm")
  t2_5d_786 <- read_excel(DAM_786, sheet = "t2_5d_norm")
  t2_20d_786 <- read_excel(DAM_786, sheet = "t2_20d_norm")
```
#load the legend specific to the timepoint t1_t2
```{r}
  legend_t1_t2_786 <- read_excel(DAM_786, sheet = "legend_t2")
  legend_t1_t2_786$chan_no <- as.factor(legend_t1_t2_786$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_786 <- subset(legend_t1_t2_786, treatment == "c")
  legend_5d_786 <- subset(legend_t1_t2_786, treatment== "5d")
  legend_20d_786 <- subset(legend_t1_t2_786, treatment== "20d")
```
#convert to data frame
```{r}
  t2_c_786 <- as.data.frame(t2_c_786)
  t2_5d_786 <- as.data.frame(t2_5d_786)
  t2_20d_786 <- as.data.frame(t2_20d_786)
```
#use the melt function to convert to long format
```{r}
  t2_c_786 <- melt(t2_c_786, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                    "9", "10", "11", "12", "13", "14", "15",
                                    "16", "17", "18", "19", "20", "21", "22",
                                    "23", "24", "25", "26", "27", "28", "29",
                                    "30", "31", "32"))
  t2_5d_786 <- melt(t2_5d_786, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12", "13", "14", "15",
                                     "16", "17", "18", "19", "20", "21", "22",
                                     "23", "24", "25", "26", "27", "28", "29",
                                     "30", "31", "32"))
  t2_20d_786 <- melt(t2_20d_786, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                      "9", "11", "12", "13", "14", "15",
                                      "16", "17", "18", "19", "20", "21", "22",
                                      "23", "24", "25", "26", "27", "28", "29",
                                      "30", "31", "32"))
```
#sanity check 1
```{r}
  summary(t2_c_786)
  summary(t2_5d_786)
  summary(t2_20d_786)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t2_c_786 <- aggregate(t2_c_786$value, by=list(chan_no=t2_c_786$variable), FUN=sum)
  t2_5d_786 <- aggregate(t2_5d_786$value, by=list(chan_no=t2_5d_786$variable), FUN=sum)
  t2_20d_786 <- aggregate(t2_20d_786$value, by=list(chan_no=t2_20d_786$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t2_c_786) <- c("chan_no", "daily_activity")
  colnames(t2_5d_786) <- c("chan_no", "daily_activity")
  colnames(t2_20d_786) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t2_c_786 <- left_join(t2_c_786, legend_c_786, by = "chan_no")
  t2_5d_786 <- left_join(t2_5d_786, legend_5d_786, by = "chan_no")
  t2_20d_786 <- left_join(t2_20d_786, legend_20d_786, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t2_c_786 <- t2_c_786[keeps]
  t2_5d_786 <- t2_5d_786[keeps]
  t2_20d_786 <- t2_20d_786[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t2_786 <- rbind(t2_c_786, t2_5d_786, t2_20d_786)
```
#sanity check 2
```{r}
  summary(master_t2_786)

  hist(master_t2_786$daily_activity)
  abline(v = mean(master_t2_786$daily_activity), col="red", lwd=3)
```


---
#Steps to load and organize all the data for the t3 timepoint
load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t3_c_786 <- read_excel(DAM_786, sheet = "t3_c_norm")
  t3_5d_786 <- read_excel(DAM_786, sheet = "t3_5d_norm")
  t3_20d_786 <- read_excel(DAM_786, sheet = "t3_20d_norm")
```
#load the legend specific to the timepoint t3
```{r}
  legend_t3_786 <- read_excel(DAM_786, sheet = "legend_t3")
  legend_t3_786$chan_no <- as.factor(legend_t3_786$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_786 <- subset(legend_t3_786, treatment == "c")
  legend_5d_786 <- subset(legend_t3_786, treatment== "5d")
  legend_20d_786 <- subset(legend_t3_786, treatment== "20d")
```
#convert to data frame
```{r}
  t3_c_786 <- as.data.frame(t3_c_786)
  t3_5d_786 <- as.data.frame(t3_5d_786)
  t3_20d_786 <- as.data.frame(t3_20d_786)
```
#use the melt function to convert to long format
```{r}
  t3_c_786 <- melt(t3_c_786, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                    "9", "10", "11", "12", "13", "14", "15",
                                    "16", "17", "18", "19", "20", "21", "22",
                                    "23", "24", "25", "26", "27", "28", "29",
                                    "30", "31", "32"))
  t3_5d_786 <- melt(t3_5d_786, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12", "13", "14", "15",
                                     "16", "17", "18", "19", "20", "21", "22",
                                     "23", "24", "25", "26", "27", "28", "29",
                                     "30", "31", "32"))
  t3_20d_786 <- melt(t3_20d_786, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                      "9", "11", "12", "13", "14", "15",
                                      "16", "17", "18", "19", "20", "21", "22",
                                      "23", "24", "25", "26", "27", "28", "29",
                                      "30", "31", "32"))
```
#sanity check 1
```{r}
  summary(t3_c_786)
  summary(t3_5d_786)
  summary(t3_20d_786)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t3_c_786 <- aggregate(t3_c_786$value, by=list(chan_no=t3_c_786$variable), FUN=sum)
  t3_5d_786 <- aggregate(t3_5d_786$value, by=list(chan_no=t3_5d_786$variable), FUN=sum)
  t3_20d_786 <- aggregate(t3_20d_786$value, by=list(chan_no=t3_20d_786$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t3_c_786) <- c("chan_no", "daily_activity")
  colnames(t3_5d_786) <- c("chan_no", "daily_activity") 
  colnames(t3_20d_786) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t3_c_786 <- left_join(t3_c_786, legend_c_786, by = "chan_no")
  t3_5d_786 <- left_join(t3_5d_786, legend_5d_786, by = "chan_no")
  t3_20d_786 <- left_join(t3_20d_786, legend_20d_786, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t3_c_786 <- t3_c_786[keeps]
  t3_5d_786 <- t3_5d_786[keeps]
  t3_20d_786 <- t3_20d_786[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t3_786 <- rbind(t3_c_786, t3_5d_786, t3_20d_786)
```
#sanity check 2
```{r}
  summary(t3_c_786)

  hist(master_t3_786$daily_activity)
  abline(v = mean(master_t3_786$daily_activity), col="red", lwd=3)
```


---






#DGRP304 genotype data to run:
loading data frames for DAM data
set file name
```{r}
DAM_304 <- "DAM_304_2023_09_25.xlsx"
```
#Steps to load and organize all the data for the t0 timepoint
load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t0_c_304 <- read_excel(DAM_304, sheet = "t0_c_norm")
  t0_5d_304 <- read_excel(DAM_304, sheet = "t0_5d_norm")
```
#load the legend specific to the timepoint t0
```{r}
  legend_t0_304 <- read_excel(DAM_304, sheet = "legend_t0")
  legend_t0_304$chan_no <- as.factor(legend_t0_304$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_304 <- subset(legend_t0_304, treatment == "c")
  legend_5d_304 <- subset(legend_t0_304, treatment== "5d")
```
#convert to data frame
```{r}
  t0_c_304 <- as.data.frame(t0_c_304)
  t0_5d_304 <- as.data.frame(t0_5d_304)
```
#use the melt function to convert to long format
```{r}
  t0_c_304 <- melt(t0_c_304, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "4", "5", "6", "7", "8",
                                    "9", "11", "12", "13", "15",
                                    "16", "17", "18", "19", "20", "21","23",
                                    "24", "25", "26", "27", "28", "29", 
                                    "31", "32", "33", "34"))
  t0_5d_304 <- melt(t0_5d_304, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12","13", "14", "15", "16",
                                     "17", "18", "19", "20", "21", "22", "23", "24",
                                     "25", "26", "27", "29", "30", "31", "32",
                                     "33", "34"))
```
#sanity check 1
```{r}
summary(t0_c_304)
  summary(t0_5d_304)
```

#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t0_c_304 <- aggregate(t0_c_304$value, by=list(chan_no=t0_c_304$variable), FUN=sum)
  t0_5d_304 <- aggregate(t0_5d_304$value, by=list(chan_no=t0_5d_304$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t0_c_304) <- c("chan_no", "daily_activity")
  colnames(t0_5d_304) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t0_c_304 <- left_join(t0_c_304, legend_c_304, by = "chan_no")
  t0_5d_304 <- left_join(t0_5d_304, legend_5d_304, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t0_c_304 <- t0_c_304[keeps]
  t0_5d_304 <- t0_5d_304[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t0_304 <- rbind(t0_c_304, t0_5d_304)
```
#sanity check 2
```{r}
  summary(master_t0_304)

  hist(master_t0_304$daily_activity)
  abline(v = mean(master_t0_304$daily_activity), col="red", lwd=3)
```


---
#Steps to load and organize all the data for the t1 timepoint
load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t1_c_304 <- read_excel(DAM_304, sheet = "t1_c_norm")
  t1_5d_304 <- read_excel(DAM_304, sheet = "t1_5d_norm")
  t1_20d_304 <- read_excel(DAM_304, sheet = "t1_20d_norm")
```
#load the legend specific to the timepoint t1
```{r}
  legend_t1_304 <- read_excel(DAM_304, sheet = "legend_t1_redo")
  legend_t1_304$chan_no <- as.factor(legend_t1_304$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_304 <- subset(legend_t1_304, treatment == "c")
  legend_5d_304 <- subset(legend_t1_304, treatment== "5d")
  legend_20d_304 <- subset(legend_t1_304, treatment== "20d")
```
#convert to data frame
```{r}
  t1_c_304 <- as.data.frame(t1_c_304)
  t1_5d_304 <- as.data.frame(t1_5d_304)
  t1_20d_304 <- as.data.frame(t1_20d_304)
```
#use the melt function to convert to long format
```{r}
  t1_c_304 <- melt(t1_c_304, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "4", "5", "6", "8",
                                    "9", "10", "11", "12","13", "14", "15", "16",
                                    "17", "18", "20", "21", "22", "24",
                                    "25", "26", "27", "29", "30", "31", "32"))
  t1_5d_304 <- melt(t1_5d_304, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "5", "7", "8",
                                     "9", "10", "11", "12","13", "14", "15", "16",
                                     "18", "20", "21", "22", "23", "24",
                                     "25", "26", "29", "30", "31"))
  t1_20d_304 <- melt(t1_20d_304, id.vars = c("index", "date", "time"), 
                     measure.vars = c("2", "3", "4", "6", "7",
                                      "9", "11", "12","13", "14", "15", "16",
                                      "17", "18", "19", "20", "21", "22", "23", "24",
                                      "25", "26", "27", "29", "30"))
```
#sanity check 1
```{r}
  summary(t1_c_304)
  summary(t1_5d_304)
  summary(t1_20d_304)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t1_c_304 <- aggregate(t1_c_304$value, by=list(chan_no=t1_c_304$variable), FUN=sum)
  t1_5d_304 <- aggregate(t1_5d_304$value, by=list(chan_no=t1_5d_304$variable), FUN=sum)
  t1_20d_304 <- aggregate(t1_20d_304$value, by=list(chan_no=t1_20d_304$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t1_c_304) <- c("chan_no", "daily_activity")
  colnames(t1_5d_304) <- c("chan_no", "daily_activity")
  colnames(t1_20d_304) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t1_c_304 <- left_join(t1_c_304, legend_c_304, by = "chan_no")
  t1_5d_304 <- left_join(t1_5d_304, legend_5d_304, by = "chan_no")
  t1_20d_304 <- left_join(t1_20d_304, legend_20d_304, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t1_c_304 <- t1_c_304[keeps]
  t1_5d_304 <- t1_5d_304[keeps]
  t1_20d_304 <- t1_20d_304[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t1_304 <- rbind(t1_c_304, t1_5d_304, t1_20d_304)
```
#sanity check 2
```{r}
  summary(master_t1_304)

  hist(master_t1_304$daily_activity)
  abline(v = mean(master_t1_304$daily_activity), col="red", lwd=3)
```


---
#Steps to load and organize all the data for the t2 timepoint
load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t2_c_304 <- read_excel(DAM_304, sheet = "t2_c_norm")
  t2_5d_304 <- read_excel(DAM_304, sheet = "t2_5d_norm")
  t2_20d_304 <- read_excel(DAM_304, sheet = "t2_20d_norm")
```
#load the legend specific to the timepoint t1_t2
```{r}
  legend_t2_304 <- read_excel(DAM_304, sheet = "legend_t2")
  legend_t2_304$chan_no <- as.factor(legend_t2_304$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_304 <- subset(legend_t2_304, treatment == "c")
  legend_5d_304 <- subset(legend_t2_304, treatment== "5d")
  legend_20d_304 <- subset(legend_t2_304, treatment== "20d")
```
#convert to data frame
```{r}
  t2_c_304 <- as.data.frame(t2_c_304)
  t2_5d_304 <- as.data.frame(t2_5d_304)
  t2_20d_304 <- as.data.frame(t2_20d_304)
```
#use the melt function to convert to long format
```{r}
  t2_c_304 <- melt(t2_c_304, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "4", "5", "6", "7", "8",
                                    "9", "11", "12", "13", "15",
                                    "16", "17", "18", "19", "20", "21","23",
                                    "24", "25", "26", "27", "28", "29", 
                                    "31", "32"))
  t2_5d_304 <- melt(t2_5d_304, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12","13", "14", "15", "16",
                                     "17", "18", "19", "20", "21", "22", "23", "24",
                                     "25", "26", "27", "29", "30", "31", "32"))
  t2_20d_304 <- melt(t2_20d_304, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                      "9", "10", "11", "12", "13", "14", "15",
                                      "16", "17", "18", "19", "20", "21", "22",
                                      "23", "24", "25", "26", "27", "28", "29", 
                                      "30", "31", "32"))
```
#sanity check 1
```{r}
  summary(t2_c_304)
  summary(t2_5d_304)
  summary(t2_20d_304)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t2_c_304 <- aggregate(t2_c_304$value, by=list(chan_no=t2_c_304$variable), FUN=sum)
  t2_5d_304 <- aggregate(t2_5d_304$value, by=list(chan_no=t2_5d_304$variable), FUN=sum)
  t2_20d_304 <- aggregate(t2_20d_304$value, by=list(chan_no=t2_20d_304$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t2_c_304) <- c("chan_no", "daily_activity")
  colnames(t2_5d_304) <- c("chan_no", "daily_activity")
  colnames(t2_20d_304) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t2_c_304 <- left_join(t2_c_304, legend_c_304, by = "chan_no")
  t2_5d_304 <- left_join(t2_5d_304, legend_5d_304, by = "chan_no")
  t2_20d_304 <- left_join(t2_20d_304, legend_20d_304, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t2_c_304 <- t2_c_304[keeps]
  t2_5d_304 <- t2_5d_304[keeps]
  t2_20d_304 <- t2_20d_304[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t2_304 <- rbind(t2_c_304, t2_5d_304, t2_20d_304)
```
#sanity check 2
```{r}
  summary(master_t2_304)

  hist(master_t2_304$daily_activity)
  abline(v = mean(master_t2_304$daily_activity), col="red", lwd=3)
```


---
#Steps to load and organize all the data for the t3 timepoint
load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t3_c_304 <- read_excel(DAM_304, sheet = "t3_c_norm")
  t3_5d_304 <- read_excel(DAM_304, sheet = "t3_5d_norm")
  t3_20d_304 <- read_excel(DAM_304, sheet = "t3_20d_norm")
```
#load the legend specific to the timepoint t3
```{r}
  legend_t3_304 <- read_excel(DAM_304, sheet = "legend_t3")
  legend_t3_304$chan_no <- as.factor(legend_t3_304$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_304 <- subset(legend_t3_304, treatment == "c")
  legend_5d_304 <- subset(legend_t3_304, treatment== "5d")
  legend_20d_304 <- subset(legend_t3_304, treatment== "20d")
```
#convert to data frame
```{r}
  t3_c_304 <- as.data.frame(t3_c_304)
  t3_5d_304 <- as.data.frame(t3_5d_304)
  t3_20d_304 <- as.data.frame(t3_20d_304)
```
#use the melt function to convert to long format
```{r}
 t3_c_304 <- melt(t3_c_304, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "4", "5", "6", "7", "8",
                                    "9", "11", "12", "13", "15",
                                    "16", "17", "18", "19", "20", "21","23",
                                    "24", "25", "26", "27", "28", "29", 
                                    "31", "32"))
  t3_5d_304 <- melt(t3_5d_304, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12","13", "14", "15", "16",
                                     "17", "18", "19", "20", "21", "22", "23", "24",
                                     "25", "26", "27", "29", "30", "31", "32"))
  t3_20d_304 <- melt(t3_20d_304, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "8",
                                      "9", "10", "11", "12", "13", "14", "15",
                                      "16", "17", "18", "19", "20", "21", "22",
                                      "23", "24", "25", "26", "27", "28", "29", 
                                      "30", "31", "32"))
```
#sanity check 1
```{r}
  summary(t3_c_304)
  summary(t3_5d_304)
  summary(t3_20d_304)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t3_c_304 <- aggregate(t3_c_304$value, by=list(chan_no=t3_c_304$variable), FUN=sum)
  t3_5d_304 <- aggregate(t3_5d_304$value, by=list(chan_no=t3_5d_304$variable), FUN=sum)
  t3_20d_304 <- aggregate(t3_20d_304$value, by=list(chan_no=t3_20d_304$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t3_c_304) <- c("chan_no", "daily_activity")
  colnames(t3_5d_304) <- c("chan_no", "daily_activity") 
  colnames(t3_20d_304) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t3_c_304 <- left_join(t3_c_304, legend_c_304, by = "chan_no")
  t3_5d_304 <- left_join(t3_5d_304, legend_5d_304, by = "chan_no")
  t3_20d_304 <- left_join(t3_20d_304, legend_20d_304, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t3_c_304 <- t3_c_304[keeps]
  t3_5d_304 <- t3_5d_304[keeps]
  t3_20d_304 <- t3_20d_304[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t3_304 <- rbind(t3_c_304, t3_5d_304, t3_20d_304)
```
#sanity check 2
```{r}
  summary(master_t3_304)

  hist(master_t3_304$daily_activity)
  abline(v = mean(master_t3_304$daily_activity), col="red", lwd=3)
```













#DGRP301
# loading data frames for DAM data
```{r}
DAM_301 <- "DAM_301_2024_06_17.xlsx"
```
#Steps to load and organize all the data for the t0 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t0_c_301 <- read_excel(DAM_301, sheet = "t0_c_norm")
  t0_5d_301 <- read_excel(DAM_301, sheet = "t0_5d_norm")
```
#load the legend specific to the timepoint t0
```{r}
  legend_t0_301 <- read_excel(DAM_301, sheet = "legend_t0")
  legend_t0_301$chan_no <- as.factor(legend_t0_301$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_301 <- subset(legend_t0_301, treatment == "c")
  legend_5d_301 <- subset(legend_t0_301, treatment== "5d")
```
#convert to data frame
```{r}
  t0_c_301 <- as.data.frame(t0_c_301)
  t0_5d_301 <- as.data.frame(t0_5d_301)
```
#use the melt function to convert to long format
```{r}
  t0_c_301 <- melt(t0_c_301, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                    "9", "10", "11", "12", "13", "14", "15",
                                    "16", "17", "18", "19", "20", "21","22","23",
                                    "24", "25", "26", "27", "28", "29", "30",
                                    "31"))
  t0_5d_301 <- melt(t0_5d_301, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12","13", "14", "15", "16",
                                     "17", "18", "19", "20", "21", "22", "23", "24",
                                     "25", "26", "27", "28", "29", "30"))
```
#sanity check 1
```{r}
  summary(t0_c_301)
  summary(t0_5d_301)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t0_c_301 <- aggregate(t0_c_301$value, by=list(chan_no=t0_c_301$variable), FUN=sum)
  t0_5d_301 <- aggregate(t0_5d_301$value, by=list(chan_no=t0_5d_301$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t0_c_301) <- c("chan_no", "daily_activity")
  colnames(t0_5d_301) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t0_c_301 <- left_join(t0_c_301, legend_c_301, by = "chan_no")
  t0_5d_301 <- left_join(t0_5d_301, legend_5d_301, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t0_c_301 <- t0_c_301[keeps]
  t0_5d_301 <- t0_5d_301[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t0_301 <- rbind(t0_c_301, t0_5d_301)
```
#sanity check 2
```{r]}
  summary(master_t0_301)

  hist(master_t0_301$daily_activity)
  abline(v = mean(master_t0_301$daily_activity), col="red", lwd=3)
```

#Steps to load and organize all the data for the t1 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t1_c_301 <- read_excel(DAM_301, sheet = "t1_c_norm")
  t1_5d_301 <- read_excel(DAM_301, sheet = "t1_5d_norm")
  t1_20d_301 <- read_excel(DAM_301, sheet = "t1_20d_norm")
```
#load the legend specific to the timepoint t1
```{r}
  legend_t1_301 <- read_excel(DAM_301, sheet = "legend")
  legend_t1_301$chan_no <- as.factor(legend_t1_301$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_301 <- subset(legend_t1_301, treatment == "c")
  legend_5d_301 <- subset(legend_t1_301, treatment== "5d")
  legend_20d_301 <- subset(legend_t1_301, treatment== "20d")
```
#convert to data frame
```{r}
  t1_c_301 <- as.data.frame(t1_c_301)
  t1_5d_301 <- as.data.frame(t1_5d_301)
  t1_20d_301 <- as.data.frame(t1_20d_301)
```
#use the melt function to convert to long format
```{r}
  t1_c_301 <- melt(t1_c_301, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                    "10", "11", "12", "13", "14", "15", "16", "17",
                                    "18", "19", "20", "21", "22", "23", "24", "25",
                                    "26", "27", "28", "29", "30", "31"))
  t1_5d_301 <- melt(t1_5d_301, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                    "10", "11", "12", "13", "14", "15", "16", "17",
                                    "18", "19", "20", "22", "23", "24", "25",
                                    "26", "27", "28", "29", "30"))
  t1_20d_301 <- melt(t1_20d_301, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                    "10", "11", "12", "13", "14", "15", "16", "17",
                                    "18", "19", "20", "21", "22", "23", "24", "25",
                                    "26", "27", "28", "29", "30"))
```
#sanity check 1
```{r}
  summary(t1_c_301)
  summary(t1_5d_301)
  summary(t1_20d_301)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t1_c_301 <- aggregate(t1_c_301$value, by=list(chan_no=t1_c_301$variable), FUN=sum)
  t1_5d_301 <- aggregate(t1_5d_301$value, by=list(chan_no=t1_5d_301$variable), FUN=sum)
  t1_20d_301 <- aggregate(t1_20d_301$value, by=list(chan_no=t1_20d_301$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t1_c_301) <- c("chan_no", "daily_activity")
  colnames(t1_5d_301) <- c("chan_no", "daily_activity")
  colnames(t1_20d_301) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t1_c_301 <- left_join(t1_c_301, legend_c_301, by = "chan_no")
  t1_5d_301 <- left_join(t1_5d_301, legend_5d_301, by = "chan_no")
  t1_20d_301 <- left_join(t1_20d_301, legend_20d_301, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age1")
  t1_c_301 <- t1_c_301[keeps]
  t1_5d_301 <- t1_5d_301[keeps]
  t1_20d_301 <- t1_20d_301[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t1_301 <- rbind(t1_c_301, t1_5d_301, t1_20d_301)
```
#rename columns
```{r}
  colnames(master_t1_301) <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
```
#sanity check 2
```{r]}
  summary(master_t1_301)

  hist(master_t1_301$daily_activity)
  abline(v = mean(master_t1_301$daily_activity), col="red", lwd=3)
```

#Steps to load and organize all the data for the t2 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t2_c_301 <- read_excel(DAM_301, sheet = "t2_c_norm")
  t2_5d_301 <- read_excel(DAM_301, sheet = "t2_5d_norm")
  t2_20d_301 <- read_excel(DAM_301, sheet = "t2_20d_norm")
```
#load the legend specific to the timepoint t1
```{r}
  legend_t2_301 <- read_excel(DAM_301, sheet = "legend")
  legend_t2_301$chan_no <- as.factor(legend_t2_301$chan_no)
```
#break the legend out by treatment in order to do a left join 
```{r}
  legend_c_301 <- subset(legend_t2_301, treatment == "c")
  legend_5d_301 <- subset(legend_t2_301, treatment== "5d")
  legend_20d_301 <- subset(legend_t2_301, treatment== "20d")
```
#convert to data frame
```{r}
  t2_c_301 <- as.data.frame(t2_c_301)
  t2_5d_301 <- as.data.frame(t2_5d_301)
  t2_20d_301 <- as.data.frame(t2_20d_301)
```
#use the melt function to convert to long format
```{r}
  t2_c_301 <- melt(t2_c_301, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                    "10", "11", "12", "13", "14", "15", "16", "17",
                                    "18", "19", "20", "21", "22", "23", "24", "25",
                                    "26", "27", "28", "29", "30", "31"))
  t2_5d_301 <- melt(t2_5d_301, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                     "10", "11", "12", "13", "14", "15", "16", "17",
                                     "18", "19", "20", "22", "23", "24", "25",
                                     "26", "27", "28", "29", "30"))
  t2_20d_301 <- melt(t2_20d_301, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                      "10", "11", "12", "13", "14", "15", "16", "17",
                                      "18", "19", "20", "21", "22", "23", "24", "25",
                                      "26", "27", "28", "29", "30"))
```
#sanity check 1
```{r}
  summary(t2_c_301)
  summary(t2_5d_301)
  summary(t2_20d_301)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t2_c_301 <- aggregate(t2_c_301$value, by=list(chan_no=t2_c_301$variable), FUN=sum)
  t2_5d_301 <- aggregate(t2_5d_301$value, by=list(chan_no=t2_5d_301$variable), FUN=sum)
  t2_20d_301 <- aggregate(t2_20d_301$value, by=list(chan_no=t2_20d_301$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t2_c_301) <- c("chan_no", "daily_activity")
  colnames(t2_5d_301) <- c("chan_no", "daily_activity")
  colnames(t2_20d_301) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t2_c_301 <- left_join(t2_c_301, legend_c_301, by = "chan_no")
  t2_5d_301 <- left_join(t2_5d_301, legend_5d_301, by = "chan_no")
  t2_20d_301 <- left_join(t2_20d_301, legend_20d_301, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age2")
  t2_c_301 <- t2_c_301[keeps]
  t2_5d_301 <- t2_5d_301[keeps]
  t2_20d_301 <- t2_20d_301[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t2_301 <- rbind(t2_c_301, t2_5d_301, t2_20d_301)
```
#rename columns
```{r}
  colnames(master_t2_301) <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
```
#sanity check 2
```{r}
  summary(master_t2_301)

  hist(master_t2_301$daily_activity)
  abline(v = mean(master_t2_301$daily_activity), col="red", lwd=3)
```
  
  

#Steps to load and organize all the data for the t3 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t3_c_301 <- read_excel(DAM_301, sheet = "t3_c_norm")
  t3_5d_301 <- read_excel(DAM_301, sheet = "t3_5d_norm")
  t3_20d_301 <- read_excel(DAM_301, sheet = "t3_20d_norm")
```
#load the legend specific to the timepoint t3
```{r}
  legend_t3_301 <- read_excel(DAM_301, sheet = "legend")
  legend_t3_301$chan_no <- as.factor(legend_t3_301$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_301 <- subset(legend_t3_301, treatment == "c")
  legend_5d_301 <- subset(legend_t3_301, treatment== "5d")
  legend_20d_301 <- subset(legend_t3_301, treatment== "20d")
```
#convert to data frame
```{r}
  t3_c_301 <- as.data.frame(t3_c_301)
  t3_5d_301 <- as.data.frame(t3_5d_301)
  t3_20d_301 <- as.data.frame(t3_20d_301)
```
#use the melt function to convert to long format
```{r}
  t3_c_301 <- melt(t3_c_301, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                    "10", "11", "12", "13", "14", "15", "16", "17",
                                    "18", "19", "20", "21", "22", "23", "24", "25",
                                    "26", "27", "28", "29", "30", "31"))
  t3_5d_301 <- melt(t3_5d_301, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                     "10", "11", "12", "13", "14", "15", "16", "17",
                                     "18", "19", "20", "22", "23", "24", "25",
                                     "26", "27", "28", "29", "30"))
  t3_20d_301 <- melt(t3_20d_301, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                      "10", "11", "12", "13", "14", "15", "16", "17",
                                      "18", "19", "20", "21", "22", "23", "24", "25",
                                      "26", "27", "28", "29", "30"))
```
#sanity check 1
```{r}
  summary(t3_c_301)
  summary(t3_5d_301)
  summary(t3_20d_301)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t3_c_301 <- aggregate(t3_c_301$value, by=list(chan_no=t3_c_301$variable), FUN=sum)
  t3_5d_301 <- aggregate(t3_5d_301$value, by=list(chan_no=t3_5d_301$variable), FUN=sum)
  t3_20d_301 <- aggregate(t3_20d_301$value, by=list(chan_no=t3_20d_301$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t3_c_301) <- c("chan_no", "daily_activity")
  colnames(t3_5d_301) <- c("chan_no", "daily_activity")
  colnames(t3_20d_301) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t3_c_301 <- left_join(t3_c_301, legend_c_301, by = "chan_no")
  t3_5d_301 <- left_join(t3_5d_301, legend_5d_301, by = "chan_no")
  t3_20d_301 <- left_join(t3_20d_301, legend_20d_301, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age3")
  t3_c_301 <- t3_c_301[keeps]
  t3_5d_301 <- t3_5d_301[keeps]
  t3_20d_301 <- t3_20d_301[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t3_301 <- rbind(t3_c_301, t3_5d_301, t3_20d_301)
```
#rename columns
```{r}
  colnames(master_t3_301) <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
```
#sanity check 2
```{r}
  summary(master_t3_301)

  hist(master_t3_301$daily_activity)
  abline(v = mean(master_t3_301$daily_activity), col="red", lwd=3)
```
  
  
  
  
  
  

---
##COMPARE MULTIPLE GENOTYPES AT THE SAME TIME
#combine the 4 genotypes into one master for each timepoint
```{r}
master_t0 <- rbind(master_t0_852, master_t0_786, master_t0_304, master_t0_301)
master_t1 <- rbind(master_t1_301, master_t1_304, master_t1_786, master_t1_852)
master_t2 <- rbind(master_t2_304, master_t2_852, master_t2_786, master_t2_301)
master_t3 <- rbind(master_t3_304, master_t3_786, master_t3_301)
```

#combine all the timepoints to create a complete figure
```{r}
ultimate_master <- rbind(master_t0, master_t1, master_t2, master_t3)
```

##two significant genotypes with all timepoints
```{r}
master_304 <- rbind(master_t0_304, master_t1_304, master_t2_304, master_t3_304)
master_786 <- rbind(master_t0_786, master_t1_786, master_t2_786, master_t3_786)
```

---
Boxplots
---

#Ultimate master plot
```{r}
boxplot_um <- ggplot(data = ultimate_master, aes(x = sex, y = daily_activity)) +
  geom_boxplot(aes(fill = treatment)) +
  facet_grid(~age ~ genotype) +
  scale_fill_manual(values = c("#0073C2FF", "#EFC000FF", "#BEBEBE"),
                    labels = c("20-day", "5-day", "Control")) +
  labs(x = "Sex", y = "Activity per fly", fill = "Treatment") +
  theme_bw() +
  theme(strip.background = element_rect(fill="white")) + 
  theme(strip.text = element_text(colour = "black"))

boxplot_um
```

#plot for sig 304 (t2)
```{r}
boxplot_304 <- ggplot(data = master_304, aes(x = sex, y = daily_activity)) +
  geom_boxplot(aes(fill = "white", color = treatment), outlier.shape = NA, size=0.75) +
  geom_jitter(aes(color = treatment), width = 0.2, size = 1, alpha = 0.6) +
  facet_grid(~age) +
  scale_fill_manual(values = "white") + 
  scale_color_manual(values = c("#0073C2FF", "#EFC000FF", "#BEBEBE"),
                     labels = c("20-day", "5-day", "Control")) +
  labs(x = "Sex", y = "Activity per fly", fill = "Treatment", color = "Treatment") +
  theme_bw() +
  theme(strip.background = element_rect(fill = "white"), 
        strip.text = element_text(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) 

boxplot_304
```




#plot for sig 786 (t0,t1,t2)
```{r}

boxplot_786 <- ggplot(data = master_786, aes(x = sex, y = daily_activity)) +
  geom_boxplot(aes(fill = "white", color = treatment), outlier.shape = NA, size=0.75) +
  geom_jitter(aes(color = treatment), width = 0.2, size = 1, alpha = 0.6) +
  facet_grid(~age) +
  scale_fill_manual(values = "white") + 
  scale_color_manual(values = c("#EFC000FF", "#BEBEBE", "#0073C2FF"),
                     labels = c("5-day", "Control", "20-day")) +
  labs(x = "Sex", y = "Activity per fly", fill = "Treatment", color = "Treatment") +
  theme_bw() +
  theme(strip.background = element_rect(fill = "white"), 
        strip.text = element_text(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) 

boxplot_786
```




---
Analysis
---
##Normal distribution Shapiro-Wilk tests
```{r}
shapiro.test(master_t0$daily_activity)
shapiro.test(master_t1$daily_activity)
shapiro.test(master_t2$daily_activity)
shapiro.test(master_t3$daily_activity)
```
#Kruskal-Wallis test as needed (change the data = name)
```{r}
kruskal.test(daily_activity ~ treatment, data = master_t0)
kruskal.test(daily_activity ~ sex, data = master_t0)
kruskal.test(daily_activity ~ genotype, data = master_t0)
```
##ANOVA****CHANGE the data name, for sex-treatment only
#Can't use ANOVA for non-normal data

anova_s <- aov(daily_activity ~ sex * treatment, 
         data = master_t0_304)
summary(anova_s)

anova_m <- aov(daily_activity ~ sex * genotype * treatment, 
         data = master_t0)
summary(anova_m)


##Ranked ANOVA for non-normal data, DGRP786 
```{r}
master_t0_786_a <- master_t0_786[order(master_t0_786$daily_activity), ]
master_t0_786_a$rank <- 1:nrow(master_t0_786_a)
master_t0_786_a <- aov(daily_activity ~ sex * treatment, data = master_t0_786)
summary(master_t0_786_a)
```
```{r}
master_t1_786_a <- master_t1_786[order(master_t1_786$daily_activity), ]
master_t1_786_a$rank <- 1:nrow(master_t1_786_a)
master_t1_786_a <- aov(daily_activity ~ sex * treatment, data = master_t1_786)
summary(master_t1_786_a)
```
```{r}
master_t2_786_a <- master_t1_786[order(master_t2_786$daily_activity), ]
master_t2_786_a$rank <- 1:nrow(master_t2_786_a)
master_t2_786_a <- aov(daily_activity ~ sex * treatment, data = master_t2_786)
summary(master_t2_786_a)
```
```{r}
master_t3_786_a <- master_t1_786[order(master_t3_786$daily_activity), ]
master_t3_786_a$rank <- 1:nrow(master_t3_786_a)
master_t3_786_a <- aov(daily_activity ~ sex * treatment, data = master_t3_786)
summary(master_t3_786_a)
```

##Ranked ANOVA for non-normal data, DGRP304
```{r}
master_t0_304_a <- master_t0_304[order(master_t0_304$daily_activity), ]
master_t0_304_a$rank <- 1:nrow(master_t0_304_a)
master_t0_304_a <- aov(daily_activity ~ sex * treatment, data = master_t0_304)
summary(master_t0_304_a)
```
```{r}
master_t1_304_a <- master_t1_304[order(master_t1_304$daily_activity), ]
master_t1_304_a$rank <- 1:nrow(master_t1_304_a)
master_t1_304_a <- aov(daily_activity ~ sex * treatment, data = master_t1_304)
summary(master_t1_304_a)
```
```{r}
master_t2_304_a <- master_t2_304[order(master_t2_304$daily_activity), ]
master_t2_304_a$rank <- 1:nrow(master_t2_304_a)
master_t2_304_a <- aov(daily_activity ~ sex * treatment, data = master_t2_304)
summary(master_t2_304_a)
```
```{r}
master_t3_304_a <- master_t3_304[order(master_t3_304$daily_activity), ]
master_t3_304_a$rank <- 1:nrow(master_t3_304_a)
master_t3_304_a <- aov(daily_activity ~ sex * treatment, data = master_t3_304)
summary(master_t3_304_a)
```

#Run the Tukey HSD, change the name
```{r}
TukeyHSD(master_t0_786_a, conf.level = 0.95)
TK <- TukeyHSD(master_t0_786_a)
TK_data<-as.data.frame(TK[3])
```



