---
title: "Figure 3"
output: html_document
date: "2024-12-17"
---

#load the library
```{r}
library(readxl)
library(car)
library(lme4)
library(reshape2)
library(ggplot2)
library(reshape)
library(dplyr)
library(here)
library(ARTool)
library(rstatix)
```
With "here" we do not need to set a working directory. Keep script and data in same folder as the Data subfolder (has .txt files) and the metadata.csv - It should already be setup and ready to use in the Data 1.zip.



#clear workspace
```{r}
rm(list = ls())
```
#check working directory
```{r}
getwd()
```

---
Load data frames for DGRP852 DAM data
#set file name
```{r}
DAM_852 <- "DAM_852_2023_04_17.xlsx"
```
---
Steps to load and organize all the data for the t0 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t0_c_852 <- read_excel(DAM_852, sheet = "t0_c_norm")
  t0_5d_852 <- read_excel(DAM_852, sheet = "t0_5d_norm")
```
#load the legend specific to the timepoint t0
```{r}
  legend_t0_852 <- read_excel(DAM_852, sheet = "legend_t0")
  legend_t0_852$chan_no <- as.factor(legend_t0_852$chan_no)
```
#break the legend out by treatment in order to do a left join 
```{r}
  legend_c_852 <- subset(legend_t0_852, treatment == "c")
  legend_5d_852 <- subset(legend_t0_852, treatment== "5d")
```
#convert to data frame
```{r}
  t0_c_852 <- as.data.frame(t0_c_852)
  t0_5d_852 <- as.data.frame(t0_5d_852)
```
#use the melt function to convert to long format
```{r}
  t0_c_852 <- melt(t0_c_852, id.vars = c("index", "date", "time"), 
             measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                              "9", "10", "11", "12", "13", "14", "15",
                              "16", "17", "18", "19", "20", "21", "22",
                              "24", "25", "26", "27", "28", "29", 
                              "30", "31", "32"))
  t0_5d_852 <- melt(t0_5d_852, id.vars = c("index", "date", "time"), 
              measure.vars = c("1", "2","3", "4", "5", "6", "7", "8",
                               "9", "10", "11", "12", "14", "15", "16",
                               "17", "18", "19", "21", "22", "23", "24",
                              "25"))
```
#sanity check 1
```{r}
  summary(t0_c_852)
  summary(t0_5d_852)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t0_c_852 <- aggregate(t0_c_852$value, by=list(chan_no=t0_c_852$variable), FUN=sum)
  t0_5d_852 <- aggregate(t0_5d_852$value, by=list(chan_no=t0_5d_852$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t0_c_852) <- c("chan_no", "daily_activity")
  colnames(t0_5d_852) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t0_c_852 <- left_join(t0_c_852, legend_c_852, by = "chan_no")
  t0_5d_852 <- left_join(t0_5d_852, legend_5d_852, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
    t0_c_852 <- t0_c_852[keeps]
    t0_5d_852 <- t0_5d_852[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t0_852 <- rbind(t0_c_852, t0_5d_852)
```
#sanity check 2
```{r}
  summary(master_t0_852)

  hist(master_t0_852$daily_activity)
  abline(v = mean(master_t0_852$daily_activity), col="red", lwd=3)
```
---
Steps to load and organize all the data for the t1 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t1_c_852 <- read_excel(DAM_852, sheet = "t1_c_norm")
  t1_5d_852 <- read_excel(DAM_852, sheet = "t1_5d_norm")
  t1_20d_852 <- read_excel(DAM_852, sheet = "t1_20d_norm")
```
#load the legend specific to the timepoint t1
```{r}
  legend_t1_t2_852 <- read_excel(DAM_852, sheet = "legend_t1")
  legend_t1_t2_852$chan_no <- as.factor(legend_t1_t2_852$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_852 <- subset(legend_t1_t2_852, treatment == "c")
  legend_5d_852 <- subset(legend_t1_t2_852, treatment== "5d")
  legend_20d_852 <- subset(legend_t1_t2_852, treatment== "20d")
```
#convert to data frame
```{r}
  t1_c_852 <- as.data.frame(t1_c_852)
  t1_5d_852 <- as.data.frame(t1_5d_852)
  t1_20d_852 <- as.data.frame(t1_20d_852)
```
#use the melt function to convert to long format
```{r}
  t1_c_852 <- melt(t1_c_852, id.vars = c("index", "date", "time"), 
               measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                "9", "10", "11", "12", "13", "14", "15",
                                "16", "17", "18", "19", "20", "21", "22",
                                "23", "24", "25", "26", "27", "28", "29", 
                                "30", "31"))
  t1_5d_852 <- melt(t1_5d_852, id.vars = c("index", "date", "time"), 
                measure.vars = c("1", "2","3", "4", "5", "6", "7", "8",
                                 "9", "10", "11", "12", "13", "14", "15",
                                 "16", "17", "18", "19", "20", "21", "22",
                                 "23"))
  t1_20d_852 <- melt(t1_20d_852, id.vars = c("index", "date", "time"), 
                 measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                  "9", "10", "11", "12", "13", "14", "15",
                                  "16", "17", "18", "19", "20", "21", "22",
                                  "23", "24", "25"))
```
#sanity check 1
```{r}
  summary(t1_c_852)
  summary(t1_5d_852)
  summary(t1_20d_852)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t1_c_852 <- aggregate(t1_c_852$value, by=list(chan_no=t1_c_852$variable), FUN=sum)
  t1_5d_852 <- aggregate(t1_5d_852$value, by=list(chan_no=t1_5d_852$variable), FUN=sum)
  t1_20d_852 <- aggregate(t1_20d_852$value, by=list(chan_no=t1_20d_852$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t1_c_852) <- c("chan_no", "daily_activity")
  colnames(t1_5d_852) <- c("chan_no", "daily_activity")
  colnames(t1_20d_852) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t1_c_852 <- left_join(t1_c_852, legend_c_852, by = "chan_no")
  t1_5d_852 <- left_join(t1_5d_852, legend_5d_852, by = "chan_no")
  t1_20d_852 <- left_join(t1_20d_852, legend_20d_852, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
    t1_c_852 <- t1_c_852[keeps]
    t1_5d_852 <- t1_5d_852[keeps]
    t1_20d_852 <- t1_20d_852[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t1_852 <- rbind(t1_c_852, t1_5d_852, t1_20d_852)
```
#sanity check 2
```{r}
  summary(master_t1_852)

  hist(master_t1_852$daily_activity)
  abline(v = mean(master_t1_852$daily_activity), col="red", lwd=3)
```
---
Steps to load and organize all the data for the t2 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t2_c_852 <- read_excel(DAM_852, sheet = "t2_c_norm")
  t2_5d_852 <- read_excel(DAM_852, sheet = "t2_5d_norm")
  t2_20d_852 <- read_excel(DAM_852, sheet = "t2_20d_norm")
```
#load the legend specific to the timepoint t1_t2
```{r}
  legend_t1_t2_852 <- read_excel(DAM_852, sheet = "legend_t2")
  legend_t1_t2_852$chan_no <- as.factor(legend_t1_t2_852$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_852 <- subset(legend_t1_t2_852, treatment == "c")
  legend_5d_852 <- subset(legend_t1_t2_852, treatment== "5d")
  legend_20d_852 <- subset(legend_t1_t2_852, treatment== "20d")
```
#convert to data frame
```{r}
  t2_c_852 <- as.data.frame(t2_c_852)
  t2_5d_852 <- as.data.frame(t2_5d_852)
  t2_20d_852 <- as.data.frame(t2_20d_852)
```
#use the melt function to convert to long format
```{r}
  t2_c_852 <- melt(t2_c_852, id.vars = c("index", "date", "time"), 
               measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                "9", "10", "11", "12", "13", "14", "15",
                                "16", "17", "18", "19", "20", "21", "22",
                                "23", "24", "25", "26", "27", "28", "29", 
                                "30", "31"))
  t2_5d_852 <- melt(t2_5d_852, id.vars = c("index", "date", "time"), 
                measure.vars = c("1", "2","3", "4", "5", "6", "7", "8",
                                 "9", "10", "11", "12", "13", "14", "15",
                                 "16", "17", "18", "19", "20", "21", "22",
                                 "23"))
  t2_20d_852 <- melt(t2_20d_852, id.vars = c("index", "date", "time"), 
                 measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                  "9", "10", "11", "12", "13", "14", "15",
                                  "16", "17", "18", "19", "20", "21", "22",
                                  "23", "24", "25"))
```
#sanity check 1
```{r}
  summary(t2_c_852)
  summary(t2_5d_852)
  summary(t2_20d_852)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t2_c_852 <- aggregate(t2_c_852$value, by=list(chan_no=t2_c_852$variable), FUN=sum)
  t2_5d_852 <- aggregate(t2_5d_852$value, by=list(chan_no=t2_5d_852$variable), FUN=sum)
  t2_20d_852 <- aggregate(t2_20d_852$value, by=list(chan_no=t2_20d_852$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t2_c_852) <- c("chan_no", "daily_activity")
  colnames(t2_5d_852) <- c("chan_no", "daily_activity")
  colnames(t2_20d_852) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t2_c_852 <- left_join(t2_c_852, legend_c_852, by = "chan_no")
  t2_5d_852 <- left_join(t2_5d_852, legend_5d_852, by = "chan_no")
  t2_20d_852 <- left_join(t2_20d_852, legend_20d_852, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t2_c_852 <- t2_c_852[keeps]
  t2_5d_852 <- t2_5d_852[keeps]
  t2_20d_852 <- t2_20d_852[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t2_852 <- rbind(t2_c_852, t2_5d_852, t2_20d_852)
```
#sanity check 2
```{r}
  summary(master_t2_852)

  hist(master_t2_852$daily_activity)
  abline(v = mean(master_t2_852$daily_activity), col="red", lwd=3)
```

Timepoint 3 was removed for DGRP852 due to a glitch in the DAM system that resulted in repeated values



---
Load data frames for DGRP786 DAM data
#set file name
```{r}
DAM_786 <- "DAM_786_2023_11_06.xlsx"
```
---
Steps to load and organize all the data for the t0 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t0_c_786 <- read_excel(DAM_786, sheet = "t0_c_norm")
  t0_5d_786 <- read_excel(DAM_786, sheet = "t0_5d_norm")
```
#load the legend specific to the timepoint t0
```{r}
  legend_786 <- read_excel(DAM_786, sheet = "legend_t0")
  legend_786$chan_no <- as.factor(legend_786$chan_no)
```
#break the legend out by treatment in order to do a left join 
```{r}
  legend_c_786 <- subset(legend_786, treatment == "c")
  legend_5d_786 <- subset(legend_786, treatment== "5d")
```
#convert to data frame
```{r}
  t0_c_786 <- as.data.frame(t0_c_786)
  t0_5d_786 <- as.data.frame(t0_5d_786)
```
#use the melt function to convert to long format
```{r}
  t0_c_786 <- melt(t0_c_786, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                    "9", "10", "11", "12", "13", "14", "15",
                                    "16", "17", "18", "19", "20", "21", "22",
                                    "23", "24", "25", "26", "27", "28", "29",
                                    "30", "31", "32"))
  t0_5d_786 <- melt(t0_5d_786, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12", "13", "14", "15",
                                     "16", "17", "18", "19", "20", "21", "22",
                                     "23", "24", "25", "26", "27", "28", "29",
                                     "30", "31", "32"))
```
#sanity check 1
```{r}
  summary(t0_c_786)
  summary(t0_5d_786)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t0_c_786 <- aggregate(t0_c_786$value, by=list(chan_no=t0_c_786$variable), FUN=sum)
  t0_5d_786 <- aggregate(t0_5d_786$value, by=list(chan_no=t0_5d_786$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t0_c_786) <- c("chan_no", "daily_activity")
  colnames(t0_5d_786) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t0_c_786 <- left_join(t0_c_786, legend_c_786, by = "chan_no")
  t0_5d_786 <- left_join(t0_5d_786, legend_5d_786, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t0_c_786 <- t0_c_786[keeps]
  t0_5d_786 <- t0_5d_786[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t0_786 <- rbind(t0_c_786, t0_5d_786)
```
#sanity check 2
```{r}
  summary(master_t0_786)

  hist(master_t0_786$daily_activity)
  abline(v = mean(master_t0_786$daily_activity), col="red", lwd=3)
```
---
Steps to load and organize all the data for the t1 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t1_c_786 <- read_excel(DAM_786, sheet = "t1_c_norm")
  t1_5d_786 <- read_excel(DAM_786, sheet = "t1_5d_norm")
  t1_20d_786 <- read_excel(DAM_786, sheet = "t1_20d_norm")
```
#load the legend specific to the timepoint
```{r}
  legend_786 <- read_excel(DAM_786, sheet = "legend_t1")
  legend_786$chan_no <- as.factor(legend_786$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_786 <- subset(legend_786, treatment == "c")
  legend_5d_786 <- subset(legend_786, treatment== "5d")
  legend_20d_786 <- subset(legend_786, treatment== "20d")
```
#convert to data frame
```{r}
  t1_c_786 <- as.data.frame(t1_c_786)
  t1_5d_786 <- as.data.frame(t1_5d_786)
  t1_20d_786 <- as.data.frame(t1_20d_786)
```
#use the melt function to convert to long format
```{r}
  t1_c_786 <- melt(t1_c_786, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                    "9", "10", "11", "12", "13", "14", "15",
                                    "16", "17", "18", "19", "20", "21", "22",
                                    "23", "24", "25", "26", "27", "28", "29",
                                    "30", "31", "32"))
  t1_5d_786 <- melt(t1_5d_786, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12", "13", "14", "15",
                                     "16", "17", "18", "19", "20", "21", "22",
                                     "23", "24", "25", "26", "27", "28", "29",
                                     "30", "31", "32"))
  t1_20d_786 <- melt(t1_20d_786, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                      "9", "11", "12", "13", "14", "15",
                                      "16", "17", "18", "19", "20", "21", "22",
                                      "23", "24", "25", "26", "27", "28", "29",
                                      "30", "31", "32"))
```
#sanity check 1
```{r}
 summary(t1_c_786)
  summary(t1_5d_786)
  summary(t1_20d_786)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t1_c_786 <- aggregate(t1_c_786$value, by=list(chan_no=t1_c_786$variable), FUN=sum)
  t1_5d_786 <- aggregate(t1_5d_786$value, by=list(chan_no=t1_5d_786$variable), FUN=sum)
  t1_20d_786 <- aggregate(t1_20d_786$value, by=list(chan_no=t1_20d_786$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t1_c_786) <- c("chan_no", "daily_activity")
  colnames(t1_5d_786) <- c("chan_no", "daily_activity")
  colnames(t1_20d_786) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t1_c_786 <- left_join(t1_c_786, legend_c_786, by = "chan_no")
  t1_5d_786 <- left_join(t1_5d_786, legend_5d_786, by = "chan_no")
  t1_20d_786 <- left_join(t1_20d_786, legend_20d_786, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t1_c_786 <- t1_c_786[keeps]
  t1_5d_786 <- t1_5d_786[keeps]
  t1_20d_786 <- t1_20d_786[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t1_786 <- rbind(t1_c_786, t1_5d_786, t1_20d_786)
```
#sanity check 2
```{r}
  summary(master_t1_786)

  hist(master_t1_786$daily_activity)
  abline(v = mean(master_t1_786$daily_activity), col="red", lwd=3)
```
---
Steps to load and organize all the data for the t2 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t2_c_786 <- read_excel(DAM_786, sheet = "t2_c_norm")
  t2_5d_786 <- read_excel(DAM_786, sheet = "t2_5d_norm")
  t2_20d_786 <- read_excel(DAM_786, sheet = "t2_20d_norm")
```
#load the legend specific to the timepoint t1_t2
```{r}
  legend_t1_t2_786 <- read_excel(DAM_786, sheet = "legend_t2")
  legend_t1_t2_786$chan_no <- as.factor(legend_t1_t2_786$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_786 <- subset(legend_t1_t2_786, treatment == "c")
  legend_5d_786 <- subset(legend_t1_t2_786, treatment== "5d")
  legend_20d_786 <- subset(legend_t1_t2_786, treatment== "20d")
```
#convert to data frame
```{r}
  t2_c_786 <- as.data.frame(t2_c_786)
  t2_5d_786 <- as.data.frame(t2_5d_786)
  t2_20d_786 <- as.data.frame(t2_20d_786)
```
#use the melt function to convert to long format
```{r}
  t2_c_786 <- melt(t2_c_786, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                    "9", "10", "11", "12", "13", "14", "15",
                                    "16", "17", "18", "19", "20", "21", "22",
                                    "23", "24", "25", "26", "27", "28", "29",
                                    "30", "31", "32"))
  t2_5d_786 <- melt(t2_5d_786, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12", "13", "14", "15",
                                     "16", "17", "18", "19", "20", "21", "22",
                                     "23", "24", "25", "26", "27", "28", "29",
                                     "30", "31", "32"))
  t2_20d_786 <- melt(t2_20d_786, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                      "9", "11", "12", "13", "14", "15",
                                      "16", "17", "18", "19", "20", "21", "22",
                                      "23", "24", "25", "26", "27", "28", "29",
                                      "30", "31", "32"))
```
#sanity check 1
```{r}
  summary(t2_c_786)
  summary(t2_5d_786)
  summary(t2_20d_786)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t2_c_786 <- aggregate(t2_c_786$value, by=list(chan_no=t2_c_786$variable), FUN=sum)
  t2_5d_786 <- aggregate(t2_5d_786$value, by=list(chan_no=t2_5d_786$variable), FUN=sum)
  t2_20d_786 <- aggregate(t2_20d_786$value, by=list(chan_no=t2_20d_786$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t2_c_786) <- c("chan_no", "daily_activity")
  colnames(t2_5d_786) <- c("chan_no", "daily_activity")
  colnames(t2_20d_786) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t2_c_786 <- left_join(t2_c_786, legend_c_786, by = "chan_no")
  t2_5d_786 <- left_join(t2_5d_786, legend_5d_786, by = "chan_no")
  t2_20d_786 <- left_join(t2_20d_786, legend_20d_786, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t2_c_786 <- t2_c_786[keeps]
  t2_5d_786 <- t2_5d_786[keeps]
  t2_20d_786 <- t2_20d_786[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t2_786 <- rbind(t2_c_786, t2_5d_786, t2_20d_786)
```
#sanity check 2
```{r}
  summary(t2_20d_786)

  hist(t2_20d_786$daily_activity)
  abline(v = mean(t2_20d_786$daily_activity), col="red", lwd=3)
```
---
Steps to load and organize all the data for the t3 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t3_c_786 <- read_excel(DAM_786, sheet = "t3_c_norm")
  t3_5d_786 <- read_excel(DAM_786, sheet = "t3_5d_norm")
  t3_20d_786 <- read_excel(DAM_786, sheet = "t3_20d_norm")
```
#load the legend specific to the timepoint t3
```{r}
  legend_t3_786 <- read_excel(DAM_786, sheet = "legend_t3")
  legend_t3_786$chan_no <- as.factor(legend_t3_786$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_786 <- subset(legend_t3_786, treatment == "c")
  legend_5d_786 <- subset(legend_t3_786, treatment== "5d")
  legend_20d_786 <- subset(legend_t3_786, treatment== "20d")
```
#convert to data frame
```{r}
  t3_c_786 <- as.data.frame(t3_c_786)
  t3_5d_786 <- as.data.frame(t3_5d_786)
  t3_20d_786 <- as.data.frame(t3_20d_786)
```
#use the melt function to convert to long format
```{r}
  t3_c_786 <- melt(t3_c_786, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                    "9", "10", "11", "12", "13", "14", "15",
                                    "16", "17", "18", "19", "20", "21", "22",
                                    "23", "24", "25", "26", "27", "28", "29",
                                    "30", "31", "32"))
  t3_5d_786 <- melt(t3_5d_786, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12", "13", "14", "15",
                                     "16", "17", "18", "19", "20", "21", "22",
                                     "23", "24", "25", "26", "27", "28", "29",
                                     "30", "31", "32"))
  t3_20d_786 <- melt(t3_20d_786, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                      "9", "11", "12", "13", "14", "15",
                                      "16", "17", "18", "19", "20", "21", "22",
                                      "23", "24", "25", "26", "27", "28", "29",
                                      "30", "31", "32"))
```
#sanity check 1
```{r}
  summary(t3_c_786)
  summary(t3_5d_786)
  summary(t3_20d_786)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t3_c_786 <- aggregate(t3_c_786$value, by=list(chan_no=t3_c_786$variable), FUN=sum)
  t3_5d_786 <- aggregate(t3_5d_786$value, by=list(chan_no=t3_5d_786$variable), FUN=sum)
  t3_20d_786 <- aggregate(t3_20d_786$value, by=list(chan_no=t3_20d_786$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t3_c_786) <- c("chan_no", "daily_activity")
  colnames(t3_5d_786) <- c("chan_no", "daily_activity") 
  colnames(t3_20d_786) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t3_c_786 <- left_join(t3_c_786, legend_c_786, by = "chan_no")
  t3_5d_786 <- left_join(t3_5d_786, legend_5d_786, by = "chan_no")
  t3_20d_786 <- left_join(t3_20d_786, legend_20d_786, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t3_c_786 <- t3_c_786[keeps]
  t3_5d_786 <- t3_5d_786[keeps]
  t3_20d_786 <- t3_20d_786[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t3_786 <- rbind(t3_c_786, t3_5d_786, t3_20d_786)
```
#sanity check 2
```{r}
  summary(t3_c_786)

  hist(master_t3_786$daily_activity)
  abline(v = mean(master_t3_786$daily_activity), col="red", lwd=3)
```
---



Load data frames for DGRP304 DAM data
#set file name
```{r}
DAM_304 <- "DAM_304_2023_09_25.xlsx"
```
---
Steps to load and organize all the data for the t0 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t0_c_304 <- read_excel(DAM_304, sheet = "t0_c_norm")
  t0_5d_304 <- read_excel(DAM_304, sheet = "t0_5d_norm")
```
#load the legend specific to the timepoint t0
```{r}
  legend_t0_304 <- read_excel(DAM_304, sheet = "legend_t0")
  legend_t0_304$chan_no <- as.factor(legend_t0_304$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_304 <- subset(legend_t0_304, treatment == "c")
  legend_5d_304 <- subset(legend_t0_304, treatment== "5d")
```
#convert to data frame
```{r}
  t0_c_304 <- as.data.frame(t0_c_304)
  t0_5d_304 <- as.data.frame(t0_5d_304)
```
#use the melt function to convert to long format
```{r}
  t0_c_304 <- melt(t0_c_304, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "4", "5", "6", "8",
                                    "9", "10", "11", "12","13", "14", "15", "16",
                                    "17", "18", "20", "21", "22", "24",
                                    "25", "26", "27", "29", "30", "31", "32"))
  t0_5d_304 <- melt(t0_5d_304, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "5", "7", "8",
                                     "9", "10", "11", "12","13", "14", "15", "16",
                                     "18", "20", "21", "22", "23", "24",
                                     "25", "26", "29", "30", "31"))
```
#sanity check 1
```{r}
  summary(t0_c_304)
  summary(t0_5d_304)
```

#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t0_c_304 <- aggregate(t0_c_304$value, by=list(chan_no=t0_c_304$variable), FUN=sum)
  t0_5d_304 <- aggregate(t0_5d_304$value, by=list(chan_no=t0_5d_304$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t0_c_304) <- c("chan_no", "daily_activity")
  colnames(t0_5d_304) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t0_c_304 <- left_join(t0_c_304, legend_c_304, by = "chan_no")
  t0_5d_304 <- left_join(t0_5d_304, legend_5d_304, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t0_c_304 <- t0_c_304[keeps]
  t0_5d_304 <- t0_5d_304[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t0_304 <- rbind(t0_c_304, t0_5d_304)
```
#sanity check 2
```{r}
  summary(master_t0_304)

  hist(master_t0_304$daily_activity)
  abline(v = mean(master_t0_304$daily_activity), col="red", lwd=3)
```
---
Steps to load and organize all the data for the t1 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t1_c_304 <- read_excel(DAM_304, sheet = "t1_c_norm")
  t1_5d_304 <- read_excel(DAM_304, sheet = "t1_5d_norm")
  t1_20d_304 <- read_excel(DAM_304, sheet = "t1_20d_norm")
```
#load the legend specific to the timepoint t1
```{r}
  legend_t1_304 <- read_excel(DAM_304, sheet = "legend_t1_redo")
  legend_t1_304$chan_no <- as.factor(legend_t1_304$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_304 <- subset(legend_t1_304, treatment == "c")
  legend_5d_304 <- subset(legend_t1_304, treatment== "5d")
  legend_20d_304 <- subset(legend_t1_304, treatment== "20d")
```
#convert to data frame
```{r}
  t1_c_304 <- as.data.frame(t1_c_304)
  t1_5d_304 <- as.data.frame(t1_5d_304)
  t1_20d_304 <- as.data.frame(t1_20d_304)
```
#use the melt function to convert to long format
```{r}
  t1_c_304 <- melt(t1_c_304, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "4", "5", "6", "8",
                                    "9", "10", "11", "12","13", "14", "15", "16",
                                    "17", "18", "20", "21", "22", "24",
                                    "25", "26", "27", "29", "30", "31", "32"))
  t1_5d_304 <- melt(t1_5d_304, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "5", "7", "8",
                                     "9", "10", "11", "12","13", "14", "15", "16",
                                     "18", "20", "21", "22", "23", "24",
                                     "25", "26", "29", "30", "31"))
  t1_20d_304 <- melt(t1_20d_304, id.vars = c("index", "date", "time"), 
                     measure.vars = c("2", "3", "4", "6", "7",
                                      "9", "11", "12","13", "14", "15", "16",
                                      "17", "18", "19", "20", "21", "22", "23", "24",
                                      "25", "26", "27", "29", "30"))
```
#sanity check 1
```{r}
  summary(t1_c_304)
  summary(t1_5d_304)
  summary(t1_20d_304)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t1_c_304 <- aggregate(t1_c_304$value, by=list(chan_no=t1_c_304$variable), FUN=sum)
  t1_5d_304 <- aggregate(t1_5d_304$value, by=list(chan_no=t1_5d_304$variable), FUN=sum)
  t1_20d_304 <- aggregate(t1_20d_304$value, by=list(chan_no=t1_20d_304$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t1_c_304) <- c("chan_no", "daily_activity")
  colnames(t1_5d_304) <- c("chan_no", "daily_activity")
  colnames(t1_20d_304) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t1_c_304 <- left_join(t1_c_304, legend_c_304, by = "chan_no")
  t1_5d_304 <- left_join(t1_5d_304, legend_5d_304, by = "chan_no")
  t1_20d_304 <- left_join(t1_20d_304, legend_20d_304, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t1_c_304 <- t1_c_304[keeps]
  t1_5d_304 <- t1_5d_304[keeps]
  t1_20d_304 <- t1_20d_304[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t1_304 <- rbind(t1_c_304, t1_5d_304, t1_20d_304)
```
#sanity check 2
```{r}
  summary(master_t1_304)

  hist(master_t1_304$daily_activity)
  abline(v = mean(master_t1_304$daily_activity), col="red", lwd=3)
```
---
Steps to load and organize all the data for the t2 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t2_c_304 <- read_excel(DAM_304, sheet = "t2_c_norm")
  t2_5d_304 <- read_excel(DAM_304, sheet = "t2_5d_norm")
  t2_20d_304 <- read_excel(DAM_304, sheet = "t2_20d_norm")
```
#load the legend specific to the timepoint t1_t2
```{r}
  legend_t2_304 <- read_excel(DAM_304, sheet = "legend_t2")
  legend_t2_304$chan_no <- as.factor(legend_t2_304$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_304 <- subset(legend_t2_304, treatment == "c")
  legend_5d_304 <- subset(legend_t2_304, treatment== "5d")
  legend_20d_304 <- subset(legend_t2_304, treatment== "20d")
```
#convert to data frame
```{r}
  t2_c_304 <- as.data.frame(t2_c_304)
  t2_5d_304 <- as.data.frame(t2_5d_304)
  t2_20d_304 <- as.data.frame(t2_20d_304)
```
#use the melt function to convert to long format
```{r}
  t2_c_304 <- melt(t2_c_304, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "4", "5", "6", "7", "8",
                                    "9", "11", "12", "13", "15",
                                    "16", "17", "18", "19", "20", "21","23",
                                    "24", "25", "26", "27", "28", "29", 
                                    "31", "32"))
  t2_5d_304 <- melt(t2_5d_304, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12","13", "14", "15", "16",
                                     "17", "18", "19", "20", "21", "22", "23", "24",
                                     "25", "26", "27", "29", "30", "31", "32"))
  t2_20d_304 <- melt(t2_20d_304, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                      "9", "10", "11", "12", "13", "14", "15",
                                      "16", "17", "18", "19", "20", "21", "22",
                                      "23", "24", "25", "26", "27", "28", "29", 
                                      "30", "31", "32"))
```
#sanity check 1
```{r}
  summary(t2_c_304)
  summary(t2_5d_304)
  summary(t2_20d_304)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t2_c_304 <- aggregate(t2_c_304$value, by=list(chan_no=t2_c_304$variable), FUN=sum)
  t2_5d_304 <- aggregate(t2_5d_304$value, by=list(chan_no=t2_5d_304$variable), FUN=sum)
  t2_20d_304 <- aggregate(t2_20d_304$value, by=list(chan_no=t2_20d_304$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t2_c_304) <- c("chan_no", "daily_activity")
  colnames(t2_5d_304) <- c("chan_no", "daily_activity")
  colnames(t2_20d_304) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t2_c_304 <- left_join(t2_c_304, legend_c_304, by = "chan_no")
  t2_5d_304 <- left_join(t2_5d_304, legend_5d_304, by = "chan_no")
  t2_20d_304 <- left_join(t2_20d_304, legend_20d_304, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t2_c_304 <- t2_c_304[keeps]
  t2_5d_304 <- t2_5d_304[keeps]
  t2_20d_304 <- t2_20d_304[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t2_304 <- rbind(t2_c_304, t2_5d_304, t2_20d_304)
```
#sanity check 2
```{r}
  summary(master_t2_304)

  hist(master_t2_304$daily_activity)
  abline(v = mean(master_t2_304$daily_activity), col="red", lwd=3)
```
---
Steps to load and organize all the data for the t3 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t3_c_304 <- read_excel(DAM_304, sheet = "t3_c_norm")
  t3_5d_304 <- read_excel(DAM_304, sheet = "t3_5d_norm")
  t3_20d_304 <- read_excel(DAM_304, sheet = "t3_20d_norm")
```
#load the legend specific to the timepoint t3
```{r}
  legend_t3_304 <- read_excel(DAM_304, sheet = "legend_t3")
  legend_t3_304$chan_no <- as.factor(legend_t3_304$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_304 <- subset(legend_t3_304, treatment == "c")
  legend_5d_304 <- subset(legend_t3_304, treatment== "5d")
  legend_20d_304 <- subset(legend_t3_304, treatment== "20d")
```
#convert to data frame
```{r}
  t3_c_304 <- as.data.frame(t3_c_304)
  t3_5d_304 <- as.data.frame(t3_5d_304)
  t3_20d_304 <- as.data.frame(t3_20d_304)
```
#use the melt function to convert to long format
```{r}
 t3_c_304 <- melt(t3_c_304, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "4", "5", "6", "7", "8",
                                    "9", "11", "12", "13", "15",
                                    "16", "17", "18", "19", "20", "21","23",
                                    "24", "25", "26", "27", "28", "29", 
                                    "31", "32"))
  t3_5d_304 <- melt(t3_5d_304, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12","13", "14", "15", "16",
                                     "17", "18", "19", "20", "21", "22", "23", "24",
                                     "25", "26", "27", "29", "30", "31", "32"))
  t3_20d_304 <- melt(t3_20d_304, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "8",
                                      "9", "10", "11", "12", "13", "14", "15",
                                      "16", "17", "18", "19", "20", "21", "22",
                                      "23", "24", "25", "26", "27", "28", "29", 
                                      "30", "31", "32"))
```
#sanity check 1
```{r}
  summary(t3_c_304)
  summary(t3_5d_304)
  summary(t3_20d_304)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t3_c_304 <- aggregate(t3_c_304$value, by=list(chan_no=t3_c_304$variable), FUN=sum)
  t3_5d_304 <- aggregate(t3_5d_304$value, by=list(chan_no=t3_5d_304$variable), FUN=sum)
  t3_20d_304 <- aggregate(t3_20d_304$value, by=list(chan_no=t3_20d_304$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t3_c_304) <- c("chan_no", "daily_activity")
  colnames(t3_5d_304) <- c("chan_no", "daily_activity") 
  colnames(t3_20d_304) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t3_c_304 <- left_join(t3_c_304, legend_c_304, by = "chan_no")
  t3_5d_304 <- left_join(t3_5d_304, legend_5d_304, by = "chan_no")
  t3_20d_304 <- left_join(t3_20d_304, legend_20d_304, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t3_c_304 <- t3_c_304[keeps]
  t3_5d_304 <- t3_5d_304[keeps]
  t3_20d_304 <- t3_20d_304[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t3_304 <- rbind(t3_c_304, t3_5d_304, t3_20d_304)
```
#sanity check 2
```{r}
  summary(master_t3_304)

  hist(master_t3_304$daily_activity)
  abline(v = mean(master_t3_304$daily_activity), col="red", lwd=3)
```



Load data frames for DGRP301 DAM data
#loading data frames for DAM data
```{r}
DAM_301 <- "DAM_301_2024_06_17.xlsx"
```
---
Steps to load and organize all the data for the t0 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t0_c_301 <- read_excel(DAM_301, sheet = "t0_c_norm")
  t0_5d_301 <- read_excel(DAM_301, sheet = "t0_5d_norm")
```
#load the legend specific to the timepoint t0
```{r}
  legend_t0_301 <- read_excel(DAM_301, sheet = "legend_t0")
  legend_t0_301$chan_no <- as.factor(legend_t0_301$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_301 <- subset(legend_t0_301, treatment == "c")
  legend_5d_301 <- subset(legend_t0_301, treatment== "5d")
```
#convert to data frame
```{r}
  t0_c_301 <- as.data.frame(t0_c_301)
  t0_5d_301 <- as.data.frame(t0_5d_301)
```
#use the melt function to convert to long format
```{r}
  t0_c_301 <- melt(t0_c_301, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                    "9", "10", "11", "12", "13", "14", "15",
                                    "16", "17", "18", "19", "20", "21","22","23",
                                    "24", "25", "26", "27", "28", "29", "30",
                                    "31"))
  t0_5d_301 <- melt(t0_5d_301, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8",
                                     "9", "10", "11", "12","13", "14", "15", "16",
                                     "17", "18", "19", "20", "21", "22", "23", "24",
                                     "25", "26", "27", "28", "29", "30"))
```
#sanity check 1
```{r}
  summary(t0_c_301)
  summary(t0_5d_301)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t0_c_301 <- aggregate(t0_c_301$value, by=list(chan_no=t0_c_301$variable), FUN=sum)
  t0_5d_301 <- aggregate(t0_5d_301$value, by=list(chan_no=t0_5d_301$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t0_c_301) <- c("chan_no", "daily_activity")
  colnames(t0_5d_301) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t0_c_301 <- left_join(t0_c_301, legend_c_301, by = "chan_no")
  t0_5d_301 <- left_join(t0_5d_301, legend_5d_301, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
  t0_c_301 <- t0_c_301[keeps]
  t0_5d_301 <- t0_5d_301[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t0_301 <- rbind(t0_c_301, t0_5d_301)
```
#sanity check 2
```{r}
  summary(master_t0_301)

  hist(master_t0_301$daily_activity)
  abline(v = mean(master_t0_301$daily_activity), col="red", lwd=3)
```
---
Steps to load and organize all the data for the t1 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t1_c_301 <- read_excel(DAM_301, sheet = "t1_c_norm")
  t1_5d_301 <- read_excel(DAM_301, sheet = "t1_5d_norm")
  t1_20d_301 <- read_excel(DAM_301, sheet = "t1_20d_norm")
```
#load the legend specific to the timepoint t1
```{r}
  legend_t1_301 <- read_excel(DAM_301, sheet = "legend")
  legend_t1_301$chan_no <- as.factor(legend_t1_301$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_301 <- subset(legend_t1_301, treatment == "c")
  legend_5d_301 <- subset(legend_t1_301, treatment== "5d")
  legend_20d_301 <- subset(legend_t1_301, treatment== "20d")
```
#convert to data frame
```{r}
  t1_c_301 <- as.data.frame(t1_c_301)
  t1_5d_301 <- as.data.frame(t1_5d_301)
  t1_20d_301 <- as.data.frame(t1_20d_301)
```
#use the melt function to convert to long format
```{r}
  t1_c_301 <- melt(t1_c_301, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                    "10", "11", "12", "13", "14", "15", "16", "17",
                                    "18", "19", "20", "21", "22", "23", "24", "25",
                                    "26", "27", "28", "29", "30", "31"))
  t1_5d_301 <- melt(t1_5d_301, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                    "10", "11", "12", "13", "14", "15", "16", "17",
                                    "18", "19", "20", "22", "23", "24", "25",
                                    "26", "27", "28", "29", "30"))
  t1_20d_301 <- melt(t1_20d_301, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                    "10", "11", "12", "13", "14", "15", "16", "17",
                                    "18", "19", "20", "21", "22", "23", "24", "25",
                                    "26", "27", "28", "29", "30"))
```
#sanity check 1
```{r}
  summary(t1_c_301)
  summary(t1_5d_301)
  summary(t1_20d_301)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t1_c_301 <- aggregate(t1_c_301$value, by=list(chan_no=t1_c_301$variable), FUN=sum)
  t1_5d_301 <- aggregate(t1_5d_301$value, by=list(chan_no=t1_5d_301$variable), FUN=sum)
  t1_20d_301 <- aggregate(t1_20d_301$value, by=list(chan_no=t1_20d_301$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t1_c_301) <- c("chan_no", "daily_activity")
  colnames(t1_5d_301) <- c("chan_no", "daily_activity")
  colnames(t1_20d_301) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t1_c_301 <- left_join(t1_c_301, legend_c_301, by = "chan_no")
  t1_5d_301 <- left_join(t1_5d_301, legend_5d_301, by = "chan_no")
  t1_20d_301 <- left_join(t1_20d_301, legend_20d_301, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age1")
  t1_c_301 <- t1_c_301[keeps]
  t1_5d_301 <- t1_5d_301[keeps]
  t1_20d_301 <- t1_20d_301[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t1_301 <- rbind(t1_c_301, t1_5d_301, t1_20d_301)
```
#rename columns
```{r}
  colnames(master_t1_301) <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
```
#sanity check 2
```{r}
  summary(master_t1_301)

  hist(master_t1_301$daily_activity)
  abline(v = mean(master_t1_301$daily_activity), col="red", lwd=3)
```

#Steps to load and organize all the data for the t2 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t2_c_301 <- read_excel(DAM_301, sheet = "t2_c_norm")
  t2_5d_301 <- read_excel(DAM_301, sheet = "t2_5d_norm")
  t2_20d_301 <- read_excel(DAM_301, sheet = "t2_20d_norm")
```
#load the legend specific to the timepoint t1
```{r}
  legend_t2_301 <- read_excel(DAM_301, sheet = "legend")
  legend_t2_301$chan_no <- as.factor(legend_t2_301$chan_no)
```
#break the legend out by treatment in order to do a left join 
```{r}
  legend_c_301 <- subset(legend_t2_301, treatment == "c")
  legend_5d_301 <- subset(legend_t2_301, treatment== "5d")
  legend_20d_301 <- subset(legend_t2_301, treatment== "20d")
```
#convert to data frame
```{r}
  t2_c_301 <- as.data.frame(t2_c_301)
  t2_5d_301 <- as.data.frame(t2_5d_301)
  t2_20d_301 <- as.data.frame(t2_20d_301)
```
#use the melt function to convert to long format
```{r}
  t2_c_301 <- melt(t2_c_301, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                    "10", "11", "12", "13", "14", "15", "16", "17",
                                    "18", "19", "20", "21", "22", "23", "24", "25",
                                    "26", "27", "28", "29", "30", "31"))
  t2_5d_301 <- melt(t2_5d_301, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                     "10", "11", "12", "13", "14", "15", "16", "17",
                                     "18", "19", "20", "22", "23", "24", "25",
                                     "26", "27", "28", "29", "30"))
  t2_20d_301 <- melt(t2_20d_301, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                      "10", "11", "12", "13", "14", "15", "16", "17",
                                      "18", "19", "20", "21", "22", "23", "24", "25",
                                      "26", "27", "28", "29", "30"))
```
#sanity check 1
```{r}
  summary(t2_c_301)
  summary(t2_5d_301)
  summary(t2_20d_301)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t2_c_301 <- aggregate(t2_c_301$value, by=list(chan_no=t2_c_301$variable), FUN=sum)
  t2_5d_301 <- aggregate(t2_5d_301$value, by=list(chan_no=t2_5d_301$variable), FUN=sum)
  t2_20d_301 <- aggregate(t2_20d_301$value, by=list(chan_no=t2_20d_301$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t2_c_301) <- c("chan_no", "daily_activity")
  colnames(t2_5d_301) <- c("chan_no", "daily_activity")
  colnames(t2_20d_301) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t2_c_301 <- left_join(t2_c_301, legend_c_301, by = "chan_no")
  t2_5d_301 <- left_join(t2_5d_301, legend_5d_301, by = "chan_no")
  t2_20d_301 <- left_join(t2_20d_301, legend_20d_301, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age2")
  t2_c_301 <- t2_c_301[keeps]
  t2_5d_301 <- t2_5d_301[keeps]
  t2_20d_301 <- t2_20d_301[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t2_301 <- rbind(t2_c_301, t2_5d_301, t2_20d_301)
```
#rename columns
```{r}
  colnames(master_t2_301) <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
```
#sanity check 2
```{r}
  summary(master_t2_301)

  hist(master_t2_301$daily_activity)
  abline(v = mean(master_t2_301$daily_activity), col="red", lwd=3)
```
---
Steps to load and organize all the data for the t3 timepoint
#load the normalized data into a dataframe for each timepoint/treatment
```{r}
  t3_c_301 <- read_excel(DAM_301, sheet = "t3_c_norm")
  t3_5d_301 <- read_excel(DAM_301, sheet = "t3_5d_norm")
  t3_20d_301 <- read_excel(DAM_301, sheet = "t3_20d_norm")
```
#load the legend specific to the timepoint t3
```{r}
  legend_t3_301 <- read_excel(DAM_301, sheet = "legend")
  legend_t3_301$chan_no <- as.factor(legend_t3_301$chan_no)
```
#break the legend out by treatment in order to do a left join
```{r}
  legend_c_301 <- subset(legend_t3_301, treatment == "c")
  legend_5d_301 <- subset(legend_t3_301, treatment== "5d")
  legend_20d_301 <- subset(legend_t3_301, treatment== "20d")
```
#convert to data frame
```{r}
  t3_c_301 <- as.data.frame(t3_c_301)
  t3_5d_301 <- as.data.frame(t3_5d_301)
  t3_20d_301 <- as.data.frame(t3_20d_301)
```
#use the melt function to convert to long format
```{r}
  t3_c_301 <- melt(t3_c_301, id.vars = c("index", "date", "time"), 
                   measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                    "10", "11", "12", "13", "14", "15", "16", "17",
                                    "18", "19", "20", "21", "22", "23", "24", "25",
                                    "26", "27", "28", "29", "30", "31"))
  t3_5d_301 <- melt(t3_5d_301, id.vars = c("index", "date", "time"), 
                    measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                     "10", "11", "12", "13", "14", "15", "16", "17",
                                     "18", "19", "20", "22", "23", "24", "25",
                                     "26", "27", "28", "29", "30"))
  t3_20d_301 <- melt(t3_20d_301, id.vars = c("index", "date", "time"), 
                     measure.vars = c("1", "2", "3", "4", "5", "6", "7", "8", "9",
                                      "10", "11", "12", "13", "14", "15", "16", "17",
                                      "18", "19", "20", "21", "22", "23", "24", "25",
                                      "26", "27", "28", "29", "30"))
```
#sanity check 1
```{r}
  summary(t3_c_301)
  summary(t3_5d_301)
  summary(t3_20d_301)
```
#after data is in long format, sum the 5-minute intervals into one daily total
```{r}
  t3_c_301 <- aggregate(t3_c_301$value, by=list(chan_no=t3_c_301$variable), FUN=sum)
  t3_5d_301 <- aggregate(t3_5d_301$value, by=list(chan_no=t3_5d_301$variable), FUN=sum)
  t3_20d_301 <- aggregate(t3_20d_301$value, by=list(chan_no=t3_20d_301$variable), FUN=sum)
```
#rename columns from variable and value
```{r}
  colnames(t3_c_301) <- c("chan_no", "daily_activity")
  colnames(t3_5d_301) <- c("chan_no", "daily_activity")
  colnames(t3_20d_301) <- c("chan_no", "daily_activity")
```
#unblind using the legends- specific to treatment- on the vial_no value
```{r}
  t3_c_301 <- left_join(t3_c_301, legend_c_301, by = "chan_no")
  t3_5d_301 <- left_join(t3_5d_301, legend_5d_301, by = "chan_no")
  t3_20d_301 <- left_join(t3_20d_301, legend_20d_301, by = "chan_no")
```
#get rid of unneeded columns
```{r}
  keeps <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age3")
  t3_c_301 <- t3_c_301[keeps]
  t3_5d_301 <- t3_5d_301[keeps]
  t3_20d_301 <- t3_20d_301[keeps]
```
#combine the treatments into one master per timepoint using rbind
```{r}
  master_t3_301 <- rbind(t3_c_301, t3_5d_301, t3_20d_301)
```
#rename columns
```{r}
  colnames(master_t3_301) <- c("chan_no", "daily_activity", "treatment", "genotype", "sex", "age")
```
#sanity check 2
```{r}
  summary(master_t3_301)

  hist(master_t3_301$daily_activity)
  abline(v = mean(master_t3_301$daily_activity), col="red", lwd=3)
```


---
#combine the 4 genotypes into a master for each timepoint
```{r}
master_t0 <- rbind(master_t0_852, master_t0_786, master_t0_304, master_t0_301)
master_t1 <- rbind(master_t1_301, master_t1_304, master_t1_786, master_t1_852)
master_t2 <- rbind(master_t2_304, master_t2_852, master_t2_786, master_t2_301)
master_t3 <- rbind(master_t3_304, master_t3_786, master_t3_301)
```
#combine all master timepoints into an ultimate_master with all the data
```{r}
ultimate_master <- rbind(master_t0, master_t1, master_t2, master_t3)
```
#ultimate master boxplot for supplementary figure 1 version 1
This version compares activity across genotype
```{r}
boxplot_um <- ggplot(data = ultimate_master, aes(x = sex, y = daily_activity)) +
  geom_boxplot(aes(fill = "white", color = treatment), outlier.shape = NA, size = 0.75) +
  geom_jitter(aes(x = sex, y = daily_activity, color = treatment), 
              alpha = 0.6, 
              position = position_jitterdodge(jitter.width = 0.2, jitter.height = 0), 
              size = 1) + 
  facet_grid(age ~ genotype) +
  scale_fill_manual(values = "white") + 
  scale_color_manual(values = c("#0073C2FF", "#EFC000FF", "#BEBEBE"),
                     labels = c("20-day", "5-day", "Control")) +
  labs(x = "Sex", y = "Activity per fly", fill = "Treatment", color = "Treatment") +
  theme_bw() +
  theme(strip.background = element_rect(fill = "white"), 
        strip.text = element_text(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())

boxplot_um
```
#ultimate master boxplot for supplementary figure 1 version 2
This compares activity across age for each genotype
```{r}
boxplot_up <- ggplot(data = ultimate_master, aes(x = sex, y = daily_activity)) +
  geom_boxplot(aes(fill = "white", color = treatment), outlier.shape = NA, size = 0.75) +
  geom_jitter(aes(x = sex, y = daily_activity, color = treatment), 
              alpha = 0.6, 
              position = position_jitterdodge(jitter.width = 0.2, jitter.height = 0), 
              size = 1) + 
  facet_grid(genotype ~ age) +
  scale_fill_manual(values = "white") + 
  scale_color_manual(values = c("#0073C2FF", "#EFC000FF", "#BEBEBE"),
                     labels = c("20-day", "5-day", "Control")) +
  labs(x = "Sex", y = "Activity per fly", fill = "Treatment", color = "Treatment") +
  theme_bw() +
  theme(strip.background = element_rect(fill = "white"), 
        strip.text = element_text(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())

boxplot_up
```






---
Master Analysis - This works with the ultimate_master data which has sex, genotype, treatment, and age
---
#kruskal-wallis tests on factors affecting daily activity from ultimate_master data
```{r}
kruskal.test(daily_activity ~ sex, data = ultimate_master)
kruskal.test(daily_activity ~ genotype, data = ultimate_master)
kruskal.test(daily_activity ~ age, data = ultimate_master)
kruskal.test(daily_activity ~ treatment, data = ultimate_master)
```
Sex, genotype, and age are significant

#shapiro-wilk normality test on ultimate_master
```{r}
ultimate_master %>%
  group_by(treatment, sex, genotype, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
Several groups are not normal

---
Outlier Tests
---
We will now test for outliers and extreme outliers

Then, we will create two sets of data 1.) all outliers removed and 2.) extreme outliers removed.

#outlier and extreme outlier detection
```{r}
ultimate_master %>%
  group_by(treatment, genotype, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,  # Regular lower bound for outliers
    upper_bound = Q3 + 1.5 * IQR,  # Regular upper bound for outliers
    extreme_lower_bound = Q1 - 3 * IQR,  # Extreme lower bound for extreme outliers
    extreme_upper_bound = Q3 + 3 * IQR,  # Extreme upper bound for extreme outliers
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound,
    extreme_outlier_flag = daily_activity < extreme_lower_bound | daily_activity > extreme_upper_bound
  ) %>%
  ungroup() %>%
  summarize(
    outlier_count = sum(outlier_flag),
    extreme_outlier_count = sum(extreme_outlier_flag)
  )
```
There were 85 outliers and 28 extreme outliers detected

#check total rows in ultimate_master
```{r}
nrow(ultimate_master)
```
There are 1210 rows total

#remove all the outliers from ultimate_master
```{r}
ultimate_master_outliers <- ultimate_master %>%
  group_by(treatment, genotype, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)
```
#sanity check that the correct number of outliers was removed
```{r}
nrow(ultimate_master_outliers)
```
1210-1225 = 85 rows were removed confirming the 85 outliers were removed

#Normality test on ultimate_master_outliers, which is data with all outliers removed
```{r}
ultimate_master_outliers %>%
  group_by(treatment, sex, genotype, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
Some groups are still not normal


#remove only the extreme outliers from ultimate_master
```{r}
ultimate_master_extremeoutliers <- ultimate_master %>%
  group_by(treatment, genotype, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    extreme_lower_bound = Q1 - 3 * IQR,
    extreme_upper_bound = Q3 + 3 * IQR,
    extreme_outlier_flag = daily_activity < extreme_lower_bound | daily_activity > extreme_upper_bound
  ) %>%
  ungroup() %>%
  filter(!extreme_outlier_flag) %>%
  select(-Q1, -Q3, -IQR, -extreme_lower_bound, -extreme_upper_bound)
```
#sanity check that the correct number of extreme outliers was removed
```{r}
nrow(ultimate_master_extremeoutliers)
```
1210-1182 = 28 rows were removed confirming the 28 extreme outliers were removed

#Normality test on ultimate_master_extremeoutliers, which is data with extreme outliers removed
```{r}
ultimate_master_extremeoutliers %>%
  group_by(treatment, sex, genotype, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
Some groups are still not normal


We realized the ordering of our variables in a regular ANOVA model matters so we are switching to a Type III sums of squares design to deal with these inconsistencies

We also compare ultimate_master (all data), ultimate_master_outliers (outliers removed), and ultimate_master_extremeoutliers (extreme outliers removed) for these mixed ANOVA tests


#create a unique id named based on sex, genotype, and channel number for all the datasets
```{r}
ultimate_master$id <- paste(ultimate_master$sex, ultimate_master$genotype, ultimate_master$treatment, ultimate_master$chan_no, sep = "_")

ultimate_master_outliers$id <- paste(ultimate_master_outliers$sex, ultimate_master_outliers$genotype, ultimate_master_outliers$treatment, ultimate_master_outliers$chan_no, sep = "_")

ultimate_master_extremeoutliers$id <- paste(ultimate_master_extremeoutliers$sex, ultimate_master_extremeoutliers$genotype, ultimate_master_extremeoutliers$treatment, ultimate_master_extremeoutliers$chan_no, sep = "_")
```

#convert variables to factors for the three datasets
```{r}
ultimate_master$genotype <- as.factor(ultimate_master$genotype)
ultimate_master$sex <- as.factor(ultimate_master$sex)
ultimate_master$age <- as.factor(ultimate_master$age)
ultimate_master$treatment <- as.factor(ultimate_master$treatment)
ultimate_master$chan_no <- as.factor(ultimate_master$chan_no)
ultimate_master$id <- as.factor(ultimate_master$id)

ultimate_master_outliers$genotype <- as.factor(ultimate_master_outliers$genotype)
ultimate_master_outliers$sex <- as.factor(ultimate_master_outliers$sex)
ultimate_master_outliers$age <- as.factor(ultimate_master_outliers$age)
ultimate_master_outliers$treatment <- as.factor(ultimate_master_outliers$treatment)
ultimate_master_outliers$chan_no <- as.factor(ultimate_master_outliers$chan_no)
ultimate_master_outliers$id <- as.factor(ultimate_master_outliers$id)

ultimate_master_extremeoutliers$genotype <- as.factor(ultimate_master_extremeoutliers$genotype)
ultimate_master_extremeoutliers$sex <- as.factor(ultimate_master_extremeoutliers$sex)
ultimate_master_extremeoutliers$age <- as.factor(ultimate_master_extremeoutliers$age)
ultimate_master_extremeoutliers$treatment <- as.factor(ultimate_master_extremeoutliers$treatment)
ultimate_master_extremeoutliers$chan_no <- as.factor(ultimate_master_extremeoutliers$chan_no)
ultimate_master_extremeoutliers$id <- as.factor(ultimate_master_extremeoutliers$id)
```

#mixed-effects model analysis with Type III ANOVA for ultimate_master
```{r}
ultimate_master_lmer <- lmer(daily_activity ~ sex * genotype * age * treatment + (1|id), data = ultimate_master)
Anova(ultimate_master_lmer, type =3)
```
#rerun mixed-effects model for ultimate_master, removing nonsignificant interactions
```{r}
ultimate_master_rerun_lmer <- lmer(daily_activity ~ sex + genotype + age + treatment + sex:genotype + sex:age + sex:treatment + sex:genotype:age + (1|id), data = ultimate_master)
Anova(ultimate_master_rerun_lmer, type =3)
```

#mixed-effects model analysis with Type III ANOVA for ultimate_master_outliers
```{r}
ultimate_master_outliers_lmer <- lmer(daily_activity ~ sex * genotype * age * treatment + (1|id), data = ultimate_master_outliers)
Anova(ultimate_master_outliers_lmer, type =3)
```
#rerun mixed-effects model for ultimate_master_outliers, removing nonsignificant interactions
```{r}
ultimate_master_outliers_rerun_lmer <- lmer(daily_activity ~ sex + genotype + age + treatment + sex:genotype + sex:age + sex:treatment + sex:genotype:age + (1|id), data = ultimate_master_outliers)
Anova(ultimate_master_outliers_rerun_lmer, type =3)
```
#mixed-effects model analysis with Type III ANOVA for ultimate_master_extremeoutliers
```{r}
ultimate_master_extremeoutliers_lmer <- lmer(daily_activity ~ sex * genotype * age * treatment + (1|id), data = ultimate_master_extremeoutliers)
Anova(ultimate_master_extremeoutliers_lmer, type =3)
```
#rerun mixed-effects model for ultimate_master_outliers, removing nonsignificant interactions
```{r}
ultimate_master_extremeoutliers_rerun_lmer <- lmer(daily_activity ~ sex + genotype + age + treatment + sex:genotype + sex:age + sex:treatment + sex:genotype:age + (1|id), data = ultimate_master_extremeoutliers)
Anova(ultimate_master_extremeoutliers_rerun_lmer, type =3)
```
#now compare models with AIC function
```{r}
AIC(ultimate_master_lmer, ultimate_master_outliers_lmer, ultimate_master_extremeoutliers_lmer)
```
Lower AIC is better, ultimate_master_outliers_lmer has the lowest AIC

We will now run a Q-Q plot and normality test for the best dataset which is the data with outliers removed
# Q-Q plot of residuals
```{r}
residuals <- resid(ultimate_master_outliers_lmer)
qqnorm(residuals)
qqline(residuals, col = "red") # Add a reference line
```
#check normality no residuals
```{r}
shapiro.test(residuals)
```
Data is not normal


Conclusions: 
- Kruskal test says sex, genotype, age, and treatment are significant (p<0.05). 
- Type 3 mixed effects ANOVA says sex, genotype, age, sex:genotype, sex:age, sex:treatment, and sex:genotype:age are significant according to our best models which is ultimate_master data with outliers removed.
- Shapiro test on residuals indicates data is not normal.


---
#Analyze each genotype with all timepoints
---
Once again, we realized the ordering of our variables in a regular ANOVA model matters so we are switching to a Type III sums of squares design to deal with these inconsistencies

DGRP852

#create a master for 852 with all 3 timepoints, remember t3 was removed
```{r}
master_852 <- rbind(master_t0_852, master_t1_852, master_t2_852)
```
#kruskal-wallis tests on factors affecting daily activity from master_852 data
```{r}
kruskal.test(daily_activity ~ sex, data = master_852)
kruskal.test(daily_activity ~ age, data = master_852)
kruskal.test(daily_activity ~ treatment, data = master_852)
```
Sex and Age are significant

#shapiro-wilk normality test on ultimate_master
```{r}
master_852 %>%
  group_by(treatment, sex, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
5 groups are not normal

---
Outlier Tests
---
#outlier and extreme outlier detection
```{r}
master_852 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,  # Regular lower bound for outliers
    upper_bound = Q3 + 1.5 * IQR,  # Regular upper bound for outliers
    extreme_lower_bound = Q1 - 3 * IQR,  # Extreme lower bound for extreme outliers
    extreme_upper_bound = Q3 + 3 * IQR,  # Extreme upper bound for extreme outliers
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound,
    extreme_outlier_flag = daily_activity < extreme_lower_bound | daily_activity > extreme_upper_bound
  ) %>%
  ungroup() %>%
  summarize(
    outlier_count = sum(outlier_flag),
    extreme_outlier_count = sum(extreme_outlier_flag)
  )
```
There were 14 outliers and 4 extreme outliers detected

#check total rows in master_852
```{r}
nrow(master_852)
```
There are 212 rows total

#remove all the outliers from master_852
```{r}
master_852_outliers <- master_852 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)
```
#sanity check that the correct number of outliers was removed
```{r}
nrow(master_852_outliers)
```
212-198 = 14 rows were removed confirming the 14 outliers were removed

#Normality test on master_852_outliers, which is data with all outliers removed
```{r}
master_852_outliers %>%
  group_by(treatment, sex, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
All groups are normal

#remove only the extreme outliers from master_852
```{r}
master_852_extremeoutliers <- master_852 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    extreme_lower_bound = Q1 - 3 * IQR,
    extreme_upper_bound = Q3 + 3 * IQR,
    extreme_outlier_flag = daily_activity < extreme_lower_bound | daily_activity > extreme_upper_bound
  ) %>%
  ungroup() %>%
  filter(!extreme_outlier_flag) %>%
  select(-Q1, -Q3, -IQR, -extreme_lower_bound, -extreme_upper_bound)
```
#sanity check that the correct number of extreme outliers was removed
```{r}
nrow(master_852_extremeoutliers)
```
212-208=4 rows were removed confirming the 4 extreme outliers were removed

#Normality test on ultimate_master_extremeoutliers, which is data with extreme outliers removed
```{r}
master_852_extremeoutliers %>%
  group_by(treatment, sex, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
2 groups are not normal

#create a unique id named based on sex, genotype, and channel number for all the datasets
```{r}
master_852$id <- paste(master_852$sex, master_852$treatment, master_852$chan_no, sep = "_")

master_852_outliers$id <- paste(master_852_outliers$sex, master_852_outliers$treatment, master_852_outliers$chan_no, sep = "_")

master_852_extremeoutliers$id <- paste(master_852_extremeoutliers$sex, master_852_extremeoutliers$treatment, master_852_extremeoutliers$chan_no, sep = "_")
```
#convert variables to factors for the three datasets
```{r}
master_852$sex <- as.factor(master_852$sex)
master_852$age <- as.factor(master_852$age)
master_852$treatment <- as.factor(master_852$treatment)
master_852$id <- as.factor(master_852$id)

master_852_outliers$sex <- as.factor(master_852_outliers$sex)
master_852_outliers$age <- as.factor(master_852_outliers$age)
master_852_outliers$treatment <- as.factor(master_852_outliers$treatment)
master_852_outliers$id <- as.factor(master_852_outliers$id)

master_852_extremeoutliers$sex <- as.factor(master_852_extremeoutliers$sex)
master_852_extremeoutliers$age <- as.factor(master_852_extremeoutliers$age)
master_852_extremeoutliers$treatment <- as.factor(master_852_extremeoutliers$treatment)
master_852_extremeoutliers$id <- as.factor(master_852_extremeoutliers$id)
```

#mixed-effects model analysis with Type III ANOVA for master_852
```{r}
master_852_lmer <- lmer(daily_activity ~ sex * age * treatment + (1|id), data = master_852)
Anova(master_852_lmer, type =3)
```
#rerun mixed-effects model for master_852, removing nonsignificant interactions
```{r}
master_852_rerun_lmer <- lmer(daily_activity ~ sex + age + treatment + sex:age +
                                     (1|id), data = master_852)
Anova(master_852_rerun_lmer, type =3)
```

#mixed-effects model analysis with Type III ANOVA for master_852_outliers
```{r}
master_852_outliers_lmer <- lmer(daily_activity ~ sex * age * treatment + (1|id), data = master_852_outliers)
Anova(master_852_outliers_lmer, type =3)
```
#rerun mixed-effects model for master_852_outliers, removing nonsignificant interactions
```{r}
master_852_outliers_rerun_lmer <- lmer(daily_activity ~ sex + age + treatment + sex:age + 
                                         (1|id), data = master_852_outliers)
Anova(master_852_outliers_rerun_lmer, type =3)
```

#mixed-effects model analysis with Type III ANOVA for master_852_extremeoutliers
```{r}
master_852_extremeoutliers_lmer <- lmer(daily_activity ~ sex * age * treatment + (1|id), data = master_852_extremeoutliers)
Anova(master_852_extremeoutliers_lmer, type =3)
```
#rerun mixed-effects model for master_852_extremeoutliers, removing nonsignificant interactions
```{r}
master_852_extremeoutliers_rerun_lmer <- lmer(daily_activity ~ sex + age + treatment + sex:age + (1|id), data = master_852_extremeoutliers)
Anova(master_852_extremeoutliers_rerun_lmer, type =3)
```
#now compare models with AIC function
```{r}
AIC(master_852_lmer, master_852_outliers_lmer, master_852_extremeoutliers_lmer)
```
Lower AIC is better, master_852_outliers has the lowest AIC

We will now run a Q-Q plot and normality test for the best dataset which is the data with outliers removed
# Q-Q plot of residuals
```{r}
residuals_852 <- resid(master_852_outliers_lmer)
qqnorm(residuals_852)
qqline(residuals_852, col = "red") # Add a reference line
```
#check normality no residuals
```{r}
shapiro.test(residuals_852)
```
Data is not normal

Conclusion: sex, age, and sex:age are significant and No treatment effects



DGRP786

#create a master for 786 with all 4 timepoints
```{r}
master_786 <- rbind(master_t0_786, master_t1_786, master_t2_786, master_t3_786)
```
#kruskal-wallis tests on factors affecting daily activity from master_786 data
```{r}
kruskal.test(daily_activity ~ sex, data = master_786)
kruskal.test(daily_activity ~ age, data = master_786)
kruskal.test(daily_activity ~ treatment, data = master_786)
```
Sex and Age are significant

#shapiro-wilk normality test on master_786
```{r}
master_786 %>%
  group_by(treatment, sex, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
17 groups are not normal

---
Outlier Tests
---
#outlier and extreme outlier detection
```{r}
master_786 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,  # Regular lower bound for outliers
    upper_bound = Q3 + 1.5 * IQR,  # Regular upper bound for outliers
    extreme_lower_bound = Q1 - 3 * IQR,  # Extreme lower bound for extreme outliers
    extreme_upper_bound = Q3 + 3 * IQR,  # Extreme upper bound for extreme outliers
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound,
    extreme_outlier_flag = daily_activity < extreme_lower_bound | daily_activity > extreme_upper_bound
  ) %>%
  ungroup() %>%
  summarize(
    outlier_count = sum(outlier_flag),
    extreme_outlier_count = sum(extreme_outlier_flag)
  )
```
There were 29 outliers and 7 extreme outliers detected

#check total rows in master_786
```{r}
nrow(master_786)
```
There are 349 rows total

#remove all the outliers from master_786
```{r}
master_786_outliers <- master_786 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)
```
#sanity check that the correct number of outliers was removed
```{r}
nrow(master_786_outliers)
```
349-320 = 29 rows were removed confirming the 29 outliers were removed

#Normality test on master_786_outliers, which is data with all outliers removed
```{r}
master_786_outliers %>%
  group_by(treatment, sex, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
9 groups not normal

#remove only the extreme outliers from master_786
```{r}
master_786_extremeoutliers <- master_786 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    extreme_lower_bound = Q1 - 3 * IQR,
    extreme_upper_bound = Q3 + 3 * IQR,
    extreme_outlier_flag = daily_activity < extreme_lower_bound | daily_activity > extreme_upper_bound
  ) %>%
  ungroup() %>%
  filter(!extreme_outlier_flag) %>%
  select(-Q1, -Q3, -IQR, -extreme_lower_bound, -extreme_upper_bound)
```
#sanity check that the correct number of extreme outliers was removed
```{r}
nrow(master_786_extremeoutliers)
```
349-342=7 rows were removed confirming the 7 extreme outliers were removed

#Normality test on master_786_extremeoutliers, which is data with extreme outliers removed
```{r}
master_786_extremeoutliers %>%
  group_by(treatment, sex, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
17 groups are not normal

#create a unique id named based on sex, genotype, and channel number for all the datasets
```{r}
master_786$id <- paste(master_786$sex, master_786$treatment, master_786$chan_no, sep = "_")

master_786_outliers$id <- paste(master_786_outliers$sex, master_786_outliers$treatment, master_786_outliers$chan_no, sep = "_")

master_786_extremeoutliers$id <- paste(master_786_extremeoutliers$sex, master_786_extremeoutliers$treatment, master_786_extremeoutliers$chan_no, sep = "_")
```

```{r}
master_786$sex <- as.factor(master_786$sex)
master_786$age <- as.factor(master_786$age)
master_786$treatment <- as.factor(master_786$treatment)
master_786$id <- as.factor(master_786$id)

master_786_outliers$sex <- as.factor(master_786_outliers$sex)
master_786_outliers$age <- as.factor(master_786_outliers$age)
master_786_outliers$treatment <- as.factor(master_786_outliers$treatment)
master_786_outliers$id <- as.factor(master_786_outliers$id)

master_786_extremeoutliers$sex <- as.factor(master_786_extremeoutliers$sex)
master_786_extremeoutliers$age <- as.factor(master_786_extremeoutliers$age)
master_786_extremeoutliers$treatment <- as.factor(master_786_extremeoutliers$treatment)
master_786_extremeoutliers$id <- as.factor(master_786_extremeoutliers$id)
```

#mixed-effects model analysis with Type III ANOVA for master_786
```{r}
master_786_lmer <- lmer(daily_activity ~ sex * age * treatment + (1|id), data = master_786)
Anova(master_786_lmer, type =3)
```
#rerun mixed-effects model for master_786, removing nonsignificant interactions
```{r}
master_786_rerun_lmer <- lmer(daily_activity ~ sex + age + treatment + sex:age + 
                                sex:age:treatment +
                                     (1|id), data = master_786)
Anova(master_786_rerun_lmer, type =3)
```

#mixed-effects model analysis with Type III ANOVA for master_786_outliers
```{r}
master_786_outliers_lmer <- lmer(daily_activity ~ sex * age * treatment + (1|id), data = master_786_outliers)
Anova(master_786_outliers_lmer, type =3)
```
#rerun mixed-effects model for master_786_outliers, removing nonsignificant interactions
```{r}
master_786_outliers_rerun_lmer <- lmer(daily_activity ~ sex + age + treatment + sex:age + 
                                         sex:age:treatment +
                                         (1|id), data = master_786_outliers)
Anova(master_786_outliers_rerun_lmer, type =3)
```

#mixed-effects model analysis with Type III ANOVA for master_786_extremeoutliers
```{r}
master_786_extremeoutliers_lmer <- lmer(daily_activity ~ sex * age * treatment + (1|id), data = master_786_extremeoutliers)
Anova(master_786_extremeoutliers_lmer, type =3)
```
#rerun mixed-effects model for master_786_extremeoutliers, removing nonsignificant interactions
```{r}
master_786_extremeoutliers_rerun_lmer <- lmer(daily_activity ~ sex + age + treatment + sex:age + sex:age:treatment + (1|id), data = master_786_extremeoutliers)
Anova(master_786_extremeoutliers_rerun_lmer, type =3)
```
#now compare models with AIC function
```{r}
AIC(master_786_lmer, master_786_outliers_lmer, master_786_extremeoutliers_lmer)
```
Lower AIC is better, master_786_outliers has the lowest AIC

We will now run a Q-Q plot and normality test for the best dataset which is the data with outliers removed
# Q-Q plot of residuals
```{r}
residuals_786 <- resid(master_852_outliers_lmer)
qqnorm(residuals_852)
qqline(residuals_852, col = "red") # Add a reference line
```
#check normality no residuals
```{r}
shapiro.test(residuals_852)
```
Data is not normal

Conclusion: Sex, sex:age, and sex:age:treatment are significant so there appears to be an interaction treatment effect between sex, age, and treatment.



DGRP304

#create a master for 304 with all 4 timepoints
```{r}
master_304 <- rbind(master_t0_304, master_t1_304, master_t2_304, master_t3_304)
```
#kruskal-wallis tests on factors affecting daily activity from master_304 data
```{r}
kruskal.test(daily_activity ~ sex, data = master_304)
kruskal.test(daily_activity ~ age, data = master_304)
kruskal.test(daily_activity ~ treatment, data = master_304)
```
Sex and Age are significant

#shapiro-wilk normality test on master_304
```{r}
master_304 %>%
  group_by(treatment, sex, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
12 groups are not normal

---
Outlier Tests
---
#outlier and extreme outlier detection
```{r}
master_304 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,  # Regular lower bound for outliers
    upper_bound = Q3 + 1.5 * IQR,  # Regular upper bound for outliers
    extreme_lower_bound = Q1 - 3 * IQR,  # Extreme lower bound for extreme outliers
    extreme_upper_bound = Q3 + 3 * IQR,  # Extreme upper bound for extreme outliers
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound,
    extreme_outlier_flag = daily_activity < extreme_lower_bound | daily_activity > extreme_upper_bound
  ) %>%
  ungroup() %>%
  summarize(
    outlier_count = sum(outlier_flag),
    extreme_outlier_count = sum(extreme_outlier_flag)
  )
```
There were 25 outliers and 10 extreme outliers detected

#check total rows in master_304
```{r}
nrow(master_304)
```
There are 318 rows total

#remove all the outliers from master_304
```{r}
master_304_outliers <- master_304 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)
```
#sanity check that the correct number of outliers was removed
```{r}
nrow(master_304_outliers)
```
318-293 = 25 rows were removed confirming the 25 outliers were removed

#Normality test on master_304_outliers, which is data with all outliers removed
```{r}
master_304_outliers %>%
  group_by(treatment, sex, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
1 group is not normal

#remove only the extreme outliers from master_304
```{r}
master_304_extremeoutliers <- master_304 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    extreme_lower_bound = Q1 - 3 * IQR,
    extreme_upper_bound = Q3 + 3 * IQR,
    extreme_outlier_flag = daily_activity < extreme_lower_bound | daily_activity > extreme_upper_bound
  ) %>%
  ungroup() %>%
  filter(!extreme_outlier_flag) %>%
  select(-Q1, -Q3, -IQR, -extreme_lower_bound, -extreme_upper_bound)
```
#sanity check that the correct number of extreme outliers was removed
```{r}
nrow(master_304_extremeoutliers)
```
318-308=10 rows were removed confirming the 10 extreme outliers were removed

#Normality test on master_304_extremeoutliers, which is data with extreme outliers removed
```{r}
master_304_extremeoutliers %>%
  group_by(treatment, sex, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
6 groups are not normal

#create a unique id named based on sex, genotype, and channel number for all the datasets
```{r}
master_304$id <- paste(master_304$sex, master_304$treatment, master_304$chan_no, sep = "_")

master_304_outliers$id <- paste(master_304_outliers$sex, master_304_outliers$treatment, master_304_outliers$chan_no, sep = "_")

master_304_extremeoutliers$id <- paste(master_304_extremeoutliers$sex, master_304_extremeoutliers$treatment, master_304_extremeoutliers$chan_no, sep = "_")
```

```{r}
master_304$sex <- as.factor(master_304$sex)
master_304$age <- as.factor(master_304$age)
master_304$treatment <- as.factor(master_304$treatment)
master_304$id <- as.factor(master_304$id)

master_304_outliers$sex <- as.factor(master_304_outliers$sex)
master_304_outliers$age <- as.factor(master_304_outliers$age)
master_304_outliers$treatment <- as.factor(master_304_outliers$treatment)
master_304_outliers$id <- as.factor(master_304_outliers$id)

master_304_extremeoutliers$sex <- as.factor(master_304_extremeoutliers$sex)
master_304_extremeoutliers$age <- as.factor(master_304_extremeoutliers$age)
master_304_extremeoutliers$treatment <- as.factor(master_304_extremeoutliers$treatment)
master_304_extremeoutliers$id <- as.factor(master_304_extremeoutliers$id)
```
#mixed-effects model analysis with Type III ANOVA for master_304
```{r}
master_304_lmer <- lmer(daily_activity ~ sex * age * treatment + (1|id), data = master_304)
Anova(master_304_lmer, type =3)
```
#rerun mixed-effects model for master_304, removing nonsignificant interactions
```{r}
master_304_rerun_lmer <- lmer(daily_activity ~ sex + age + treatment + sex:age + 
                                sex:treatment +
                                     (1|id), data = master_304)
Anova(master_304_rerun_lmer, type =3)
```

#mixed-effects model analysis with Type III ANOVA for master_304_outliers
```{r}
master_304_outliers_lmer <- lmer(daily_activity ~ sex * age * treatment + (1|id), data = master_304_outliers)
Anova(master_304_outliers_lmer, type =3)
```
#rerun mixed-effects model for master_304_outliers, removing nonsignificant interactions
```{r}
master_304_outliers_rerun_lmer <- lmer(daily_activity ~ sex + age + treatment + sex:age + 
                                         sex:treatment + sex:age:treatment +
                                         (1|id), data = master_304_outliers)
Anova(master_304_outliers_rerun_lmer, type =3)
```

#mixed-effects model analysis with Type III ANOVA for master_304_extremeoutliers
```{r}
master_304_extremeoutliers_lmer <- lmer(daily_activity ~ sex * age * treatment + (1|id), data = master_304_extremeoutliers)
Anova(master_304_extremeoutliers_lmer, type =3)
```
#rerun mixed-effects model for master_304_extremeoutliers, removing nonsignificant interactions
```{r}
master_304_extremeoutliers_rerun_lmer <- lmer(daily_activity ~ sex + age + treatment + sex:age + sex:treatment + sex:age:treatment + (1|id), data = master_304_extremeoutliers)
Anova(master_304_extremeoutliers_rerun_lmer, type =3)
```
#now compare models with AIC function
```{r}
AIC(master_304_lmer, master_304_outliers_lmer, master_304_extremeoutliers_lmer)
```
Lower AIC is better, master_304_outliers has the lowest AIC

We will now run a Q-Q plot and normality test for the best dataset which is the data with outliers removed
# Q-Q plot of residuals
```{r}
residuals_304 <- resid(master_304_outliers_lmer)
qqnorm(residuals_304)
qqline(residuals_304, col = "red") # Add a reference line
```
#check normality no residuals
```{r}
shapiro.test(residuals_304)
```
Data is not normal

Conclussion: Sex, age, treatment, sex:age, sex:treatment, and sex:age:treatment are significant. So some treatment interaction with age and sex possibly.



DGRP301

#create a master for 301 with all 4 timepoints
```{r}
master_301 <- rbind(master_t0_301, master_t1_301, master_t2_301, master_t3_301)
```
#kruskal-wallis tests on factors affecting daily activity from master_301 data
```{r}
kruskal.test(daily_activity ~ sex, data = master_301)
kruskal.test(daily_activity ~ age, data = master_301)
kruskal.test(daily_activity ~ treatment, data = master_301)
```
Sex, Age, and Treatment are significant

#shapiro-wilk normality test on master_301
```{r}
master_301 %>%
  group_by(treatment, sex, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
10 groups are not normal

---
Outlier Tests
---
#outlier and extreme outlier detection
```{r}
master_301 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,  # Regular lower bound for outliers
    upper_bound = Q3 + 1.5 * IQR,  # Regular upper bound for outliers
    extreme_lower_bound = Q1 - 3 * IQR,  # Extreme lower bound for extreme outliers
    extreme_upper_bound = Q3 + 3 * IQR,  # Extreme upper bound for extreme outliers
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound,
    extreme_outlier_flag = daily_activity < extreme_lower_bound | daily_activity > extreme_upper_bound
  ) %>%
  ungroup() %>%
  summarize(
    outlier_count = sum(outlier_flag),
    extreme_outlier_count = sum(extreme_outlier_flag)
  )
```
There were 17 outliers and 7 extreme outliers detected

#check total rows in master_301
```{r}
nrow(master_301)
```
There are 331 rows total

#remove all the outliers from master_301
```{r}
master_301_outliers <- master_301 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)
```
#sanity check that the correct number of outliers was removed
```{r}
nrow(master_301_outliers)
```
331-314 = 17 rows were removed confirming the 17 outliers were removed

#Normality test on master_301_outliers, which is data with all outliers removed
```{r}
master_301_outliers %>%
  group_by(treatment, sex, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
3 group is not normal

#remove only the extreme outliers from master_301
```{r}
master_301_extremeoutliers <- master_301 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    extreme_lower_bound = Q1 - 3 * IQR,
    extreme_upper_bound = Q3 + 3 * IQR,
    extreme_outlier_flag = daily_activity < extreme_lower_bound | daily_activity > extreme_upper_bound
  ) %>%
  ungroup() %>%
  filter(!extreme_outlier_flag) %>%
  select(-Q1, -Q3, -IQR, -extreme_lower_bound, -extreme_upper_bound)
```
#sanity check that the correct number of extreme outliers was removed
```{r}
nrow(master_301_extremeoutliers)
```
331-324=7 rows were removed confirming the 7 extreme outliers were removed

#Normality test on master_301_extremeoutliers, which is data with extreme outliers removed
```{r}
master_301_extremeoutliers %>%
  group_by(treatment, sex, age) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
5 groups are not normal

#create a unique id named based on sex, genotype, and channel number for all the datasets
```{r}
master_301$id <- paste(master_301$sex, master_301$treatment, master_301$chan_no, sep = "_")

master_301_outliers$id <- paste(master_301_outliers$sex, master_301_outliers$treatment, master_301_outliers$chan_no, sep = "_")

master_301_extremeoutliers$id <- paste(master_301_extremeoutliers$sex, master_301_extremeoutliers$treatment, master_301_extremeoutliers$chan_no, sep = "_")
```

```{r}
master_301$sex <- as.factor(master_301$sex)
master_301$age <- as.factor(master_301$age)
master_301$treatment <- as.factor(master_301$treatment)
master_301$id <- as.factor(master_301$id)

master_301_outliers$sex <- as.factor(master_301_outliers$sex)
master_301_outliers$age <- as.factor(master_301_outliers$age)
master_301_outliers$treatment <- as.factor(master_301_outliers$treatment)
master_301_outliers$id <- as.factor(master_301_outliers$id)

master_301_extremeoutliers$sex <- as.factor(master_301_extremeoutliers$sex)
master_301_extremeoutliers$age <- as.factor(master_301_extremeoutliers$age)
master_301_extremeoutliers$treatment <- as.factor(master_301_extremeoutliers$treatment)
master_301_extremeoutliers$id <- as.factor(master_301_extremeoutliers$id)
```

#mixed-effects model analysis with Type III ANOVA for master_301
```{r}
master_301_lmer <- lmer(daily_activity ~ sex * age * treatment + (1|id), data = master_301)
Anova(master_301_lmer, type =3)
```
#rerun mixed-effects model for master_301, removing nonsignificant interactions
```{r}
master_301_rerun_lmer <- lmer(daily_activity ~ sex + age + treatment + sex:age +
                                     (1|id), data = master_301)
Anova(master_301_rerun_lmer, type =3)
```

#mixed-effects model analysis with Type III ANOVA for master_301_outliers
```{r}
master_301_outliers_lmer <- lmer(daily_activity ~ sex * age * treatment + (1|id), data = master_301_outliers)
Anova(master_301_outliers_lmer, type =3)
```
#rerun mixed-effects model for master_301_outliers, removing nonsignificant interactions
```{r}
master_301_outliers_rerun_lmer <- lmer(daily_activity ~ sex + age + treatment + sex:age +
                                         (1|id), data = master_301_outliers)
Anova(master_301_outliers_rerun_lmer, type =3)
```
#mixed-effects model analysis with Type III ANOVA for master_301_extremeoutliers
```{r}
master_301_extremeoutliers_lmer <- lmer(daily_activity ~ sex * age * treatment + (1|id), data = master_301_extremeoutliers)
Anova(master_301_extremeoutliers_lmer, type =3)
```
#rerun mixed-effects model for master_301_extremeoutliers, removing nonsignificant interactions
```{r}
master_301_extremeoutliers_rerun_lmer <- lmer(daily_activity ~ sex + age + treatment + sex:age + (1|id), data = master_301_extremeoutliers)
Anova(master_301_extremeoutliers_rerun_lmer, type =3)
```
#now compare models with AIC function
```{r}
AIC(master_301_lmer, master_301_outliers_lmer, master_301_extremeoutliers_lmer)
```
Lower AIC is better, master_301_outliers has the lowest AIC

We will now run a Q-Q plot and normality test for the best dataset which is the data with outliers removed
# Q-Q plot of residuals
```{r}
residuals_301 <- resid(master_301_outliers_lmer)
qqnorm(residuals_301)
qqline(residuals_301, col = "red") # Add a reference line
```
#check normality no residuals
```{r}
shapiro.test(residuals_301)
```
Data is not normal

Conclusion: Kruskal-wallis significant treatment effect but then appears to be lost in the ANOVA.







---
#Analysis of treatment effects at a specific genotype/sex/age
---
We are interested in seeing where there is a treatment effect so we subset to a specific age/sex/genotype group with all treatments included and compare C-5D and C-20D. Remember that the first age only has control and 5-day.

Also, based on what we have seen, we will move forward with outlier removed datasets as they are the best model and most normal across the board.

**DGRP852**
#subset by sex for each age for DGRP852
t3 data removed due to DAMs glitching
```{r}
females852_t0 <- master_t0_852 %>% filter(sex == "F")
males852_t0 <- master_t0_852 %>% filter(sex == "M")

females852_t1 <- master_t1_852 %>% filter(sex == "F")
males852_t1 <- master_t1_852 %>% filter(sex == "M")

females852_t2 <- master_t2_852 %>% filter(sex == "F")
males852_t2 <- master_t2_852 %>% filter(sex == "M")
```

#kruskal-wallis tests on treatment factor affecting daily activity
```{r}
kruskal.test(daily_activity ~ treatment, data = females852_t0)
kruskal.test(daily_activity ~ treatment, data = males852_t0)

kruskal.test(daily_activity ~ treatment, data = females852_t1)
kruskal.test(daily_activity ~ treatment, data = males852_t1)

kruskal.test(daily_activity ~ treatment, data = females852_t2)
kruskal.test(daily_activity ~ treatment, data = males852_t2)
```
No significant treatment effect

#adjust KW for multiple testing
```{r}
p <- c(0.3153, 0.6275, 0.06497, 0.2434, 0.06652, 0.7456)
p.adjust(p, method = "fdr", n = length(p))
```
None significant

#shapiro-wilk normality test
Change dataset as needed to test
```{r}
males852_t0 %>%
  group_by(treatment) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
These were the datasets with non-normal data, still most groups were normal

#outlier and extreme outlier detection
Change the dataset before the "%>%" symbol to test for outliers, a summary of the findings are also available on lines 3347-3352
```{r}
females852_t0 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,  # Regular lower bound for outliers
    upper_bound = Q3 + 1.5 * IQR,  # Regular upper bound for outliers
    extreme_lower_bound = Q1 - 3 * IQR,  # Extreme lower bound for extreme outliers
    extreme_upper_bound = Q3 + 3 * IQR,  # Extreme upper bound for extreme outliers
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound,
    extreme_outlier_flag = daily_activity < extreme_lower_bound | daily_activity > extreme_upper_bound
  ) %>%
  ungroup() %>%
  summarize(
    outlier_count = sum(outlier_flag),
    extreme_outlier_count = sum(extreme_outlier_flag)
  )
```
Females_t0 had 2 outliers, 0 extreme outliers
Males_t0 had 2 outliers, 0 extreme outliers
Females_t1 had 4 outliers, 3 extreme outliers
Males_t1 had 3 outliers, 0 extreme outliers
Females_t2 had 1 outlier, 1 extreme outlier
Males_t2 had 2 outliers, 0 extreme outliers

#remove all the outliers from all the groups with outliers
```{r}
females852_t0_outliers <- females852_t0 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

males852_t0_outliers <- males852_t0 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

females852_t1_outliers <- females852_t1 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

males852_t1_outliers <- males852_t1 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

females852_t2_outliers <- females852_t2 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

males852_t2_outliers <- males852_t2 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)
```
#Normality test on data with outliers removed
Change the dataset name to check each one
```{r}
females852_t0_outliers %>%
  group_by(treatment) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
Now all groups are normal

#convert treatment to factor
```{r}
females852_t0_outliers$treatment <- as.factor(females852_t0_outliers$treatment)
males852_t0_outliers$treatment <- as.factor(males852_t0_outliers$treatment)
females852_t1_outliers$treatment <- as.factor(females852_t1_outliers$treatment)
males852_t1_outliers$treatment <- as.factor(males852_t1_outliers$treatment)
females852_t2_outliers$treatment <- as.factor(females852_t2_outliers$treatment)
males852_t2_outliers$treatment <- as.factor(males852_t2_outliers$treatment)
```

#analysis with Type III ANOVA for females and males with outliers removed
```{r}
females852_t0_outliers_aov <- aov(daily_activity ~ treatment, data = females852_t0_outliers)
Anova(females852_t0_outliers_aov, type = 3)

males852_t0_outliers_aov <- aov(daily_activity ~ treatment, data = males852_t0_outliers)
Anova(males852_t0_outliers_aov, type = 3)

females852_t1_outliers_aov <- aov(daily_activity ~ treatment, data = females852_t1_outliers)
Anova(females852_t1_outliers_aov, type = 3)

males852_t1_outliers_aov <- aov(daily_activity ~ treatment, data = males852_t1_outliers)
Anova(males852_t1_outliers_aov, type = 3)

females852_t2_outliers_aov <- aov(daily_activity ~ treatment, data = females852_t2_outliers)
Anova(females852_t2_outliers_aov, type = 3)

males852_t2_outliers_aov <- aov(daily_activity ~ treatment, data = males852_t2_outliers)
Anova(males852_t2_outliers_aov, type = 3)

```
#adjust Anovas for multiple testing
```{r}
p <- c(0.04505, 0.8299, 0.01542, 0.3291, 0.007007, 0.5435)
p.adjust(p, method = "fdr", n = length(p))
```
Females 852 t1 and t2 significant

We will now run a Q-Q plot and normality test for the best dataset
# Q-Q plot of residuals
Change the data name as needed to test
```{r}
QQ852_residuals <- resid(females852_t0_outliers_aov)
qqnorm(QQ852_residuals)
qqline(QQ852_residuals, col = "red")
```
#check normality no residuals
```{r}
shapiro.test(QQ852_residuals)
```

# Pairwise t-test with multiple corrections
Performed only on data with significant treatment effect for adjusted p-values
```{r}
pairwise_males_t1 <- pairwise.t.test(males852_t1_outliers$daily_activity, males852_t1_outliers$treatment, p.adjust.method = "bonferroni")
print(pairwise_males_t1)

pairwise_females_t2 <- pairwise.t.test(females852_t2_outliers$daily_activity, females852_t2_outliers$treatment, p.adjust.method = "bonferroni")
print(pairwise_females_t2)
```
Females 852 t2 c-5d






**DGRP786**
# Subset by Sex for Each Age for DGRP786
```{r}
females786_t0 <- master_t0_786 %>% filter(sex == "F")
males786_t0 <- master_t0_786 %>% filter(sex == "M")
females786_t1 <- master_t1_786 %>% filter(sex == "F")
males786_t1 <- master_t1_786 %>% filter(sex == "M")
females786_t2 <- master_t2_786 %>% filter(sex == "F")
males786_t2 <- master_t2_786 %>% filter(sex == "M")
females786_t3 <- master_t3_786 %>% filter(sex == "F")
males786_t3 <- master_t3_786 %>% filter(sex == "M")
```
# Kruskal-Wallis Tests on Treatment Factor Affecting Daily Activity for DGRP786
```{r}
kruskal.test(daily_activity ~ treatment, data = females786_t0)
kruskal.test(daily_activity ~ treatment, data = males786_t0)
kruskal.test(daily_activity ~ treatment, data = females786_t1)
kruskal.test(daily_activity ~ treatment, data = males786_t1)
kruskal.test(daily_activity ~ treatment, data = females786_t2)
kruskal.test(daily_activity ~ treatment, data = males786_t2)
kruskal.test(daily_activity ~ treatment, data = females786_t3)
kruskal.test(daily_activity ~ treatment, data = males786_t3)
```

#adjust KW for multiple testing
```{r}
p <- c(0.2345, 0.02425, 0.4006, 0.004454, 0.5873, 0.003509, 0.9094, 0.6557)
p.adjust(p, method = "fdr", n = length(p))
```
males 786 t1 and t2

# Shapiro-Wilk Normality Test for DGRP786
Change dataset name as needed to test normality for all groups
```{r}
males786_t0 %>%
  group_by(treatment) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
Some non-normal groups

# Outlier and Extreme Outlier Detection for DGRP786
Change the dataset you look at as needed to check
```{r}
males786_t3 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,  # Regular lower bound for outliers
    upper_bound = Q3 + 1.5 * IQR,  # Regular upper bound for outliers
    extreme_lower_bound = Q1 - 3 * IQR,  # Extreme lower bound for extreme outliers
    extreme_upper_bound = Q3 + 3 * IQR,  # Extreme upper bound for extreme outliers
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound,
    extreme_outlier_flag = daily_activity < extreme_lower_bound | daily_activity > extreme_upper_bound
  ) %>%
  ungroup() %>%
  summarize(
    outlier_count = sum(outlier_flag),
    extreme_outlier_count = sum(extreme_outlier_flag)
  )
```
Females786_t0 - 3 outliers
Females786_t1 - 5 outliers, 1 extreme
Females786_t2 - 2 outliers, 1 extreme
Females786_t3 - 7 outliers, 2 extreme
Males786_t0 - 2 outliers, 1 extreme
Males786_t1 - 3 outliers
Males786_t2 - 4 outliers
Males786_t3 - 3 outliers, 2 extreme

# Remove all the outliers from all the groups with outliers for DGRP786
```{r}
females786_t0_outliers <- females786_t0 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

males786_t0_outliers <- males786_t0 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

females786_t1_outliers <- females786_t1 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

males786_t1_outliers <- males786_t1 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

females786_t2_outliers <- females786_t2 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

males786_t2_outliers <- males786_t2 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

females786_t3_outliers <- females786_t3 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

males786_t3_outliers <- males786_t3 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)
```
# Normality test on data with outliers removed for DGRP786
Change the dataset name as needed to test normality
```{r}
females786_t1_outliers %>%
  group_by(treatment) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
Mostly normal

# Convert treatment to factor for DGRP786
```{r}
females786_t0_outliers$treatment <- as.factor(females786_t0_outliers$treatment)
males786_t0_outliers$treatment <- as.factor(males786_t0_outliers$treatment)
females786_t1_outliers$treatment <- as.factor(females786_t1_outliers$treatment)
males786_t1_outliers$treatment <- as.factor(males786_t1_outliers$treatment)
females786_t2_outliers$treatment <- as.factor(females786_t2_outliers$treatment)
males786_t2_outliers$treatment <- as.factor(males786_t2_outliers$treatment)
females786_t3_outliers$treatment <- as.factor(females786_t3_outliers$treatment)
males786_t3_outliers$treatment <- as.factor(males786_t3_outliers$treatment)
```

# Analysis with Type III ANOVA for females and males with outliers removed for DGRP786
```{r}
females786_t0_outliers_aov <- aov(daily_activity ~ treatment, data = females786_t0_outliers)
Anova(females786_t0_outliers_aov, type = 3)

males786_t0_outliers_aov <- aov(daily_activity ~ treatment, data = males786_t0_outliers)
Anova(males786_t0_outliers_aov, type = 3)

females786_t1_outliers_aov <- aov(daily_activity ~ treatment, data = females786_t1_outliers)
Anova(females786_t1_outliers_aov, type = 3)

males786_t1_outliers_aov <- aov(daily_activity ~ treatment, data = males786_t1_outliers)
Anova(males786_t1_outliers_aov, type = 3)

females786_t2_outliers_aov <- aov(daily_activity ~ treatment, data = females786_t2_outliers)
Anova(females786_t2_outliers_aov, type = 3)

males786_t2_outliers_aov <- aov(daily_activity ~ treatment, data = males786_t2_outliers)
Anova(males786_t2_outliers_aov, type = 3)

females786_t3_outliers_aov <- aov(daily_activity ~ treatment, data = females786_t3_outliers)
Anova(females786_t2_outliers_aov, type = 3)

males786_t3_outliers_aov <- aov(daily_activity ~ treatment, data = males786_t3_outliers)
Anova(males786_t2_outliers_aov, type = 3)
```
#adjust Anova for multiple testing
```{r}
p <- c(0.2518, 0.05168, 0.36530, 0.003063, 0.4307, 0.0006605, 0.4307, 0.0006605)
p.adjust(p, method = "fdr", n = length(p))
```
Males 786 t1, t2, and t3 significant treatment effects

# Q-Q plot of residuals for the best dataset
Change dataset name to test as needed
```{r}
QQ786_residuals <- resid(males786_t1_outliers_aov)
qqnorm(QQ786_residuals)
qqline(QQ786_residuals, col = "red")
```
# Check normality of residuals
```{r}
shapiro.test(QQ786_residuals)
```

# Pairwise t-test with multiple corrections
Performed on data with outliers removed
```{r}
pairwise_males_t1 <- pairwise.t.test(males786_t1_outliers$daily_activity, males786_t1_outliers$treatment, p.adjust.method = "bonferroni")
print(pairwise_males_t1)

pairwise_males_t2 <- pairwise.t.test(males786_t2_outliers$daily_activity, males786_t2_outliers$treatment, p.adjust.method = "bonferroni")
print(pairwise_males_t2)

pairwise_males_t3 <- pairwise.t.test(males786_t3_outliers$daily_activity, males786_t3_outliers$treatment, p.adjust.method = "bonferroni")
print(pairwise_males_t3)
```
Males 786 t1 5d-20d
Males 786 t2 5d-20d, c-20d
Males 786 t3 None


**DGRP301**
# Subset by Sex for Each Age for DGRP301
```{r}
females301_t0 <- master_t0_301 %>% filter(sex == "F")
males301_t0 <- master_t0_301 %>% filter(sex == "M")
females301_t1 <- master_t1_301 %>% filter(sex == "F")
males301_t1 <- master_t1_301 %>% filter(sex == "M")
females301_t2 <- master_t2_301 %>% filter(sex == "F")
males301_t2 <- master_t2_301 %>% filter(sex == "M")
females301_t3 <- master_t3_301 %>% filter(sex == "F")
males301_t3 <- master_t3_301 %>% filter(sex == "M")
```
# Kruskal-Wallis Tests on Treatment Factor Affecting Daily Activity for DGRP301
```{r}
kruskal.test(daily_activity ~ treatment, data = females301_t0)
kruskal.test(daily_activity ~ treatment, data = males301_t0)
kruskal.test(daily_activity ~ treatment, data = females301_t1)
kruskal.test(daily_activity ~ treatment, data = males301_t1)
kruskal.test(daily_activity ~ treatment, data = females301_t2)
kruskal.test(daily_activity ~ treatment, data = males301_t2)
kruskal.test(daily_activity ~ treatment, data = females301_t3)
kruskal.test(daily_activity ~ treatment, data = males301_t3)
```
#adjust KW for multiple testing
```{r}
p <- c(0.04811, 0.1345, 0.11, 0.7742, 0.6448, 0.3044, 0.08977, 0.1602)
p.adjust(p, method = "fdr", n = length(p))
```
None significant

# Shapiro-Wilk Normality Test for DGRP301
Change dataset as needed to check all groups
```{r}
females301_t0 %>%
  group_by(treatment) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
Some non-normal groups

# Outlier and Extreme Outlier Detection for DGRP301
Change the dataset as needed to check
```{r}
females301_t0 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,  # Regular lower bound for outliers
    upper_bound = Q3 + 1.5 * IQR,  # Regular upper bound for outliers
    extreme_lower_bound = Q1 - 3 * IQR,  # Extreme lower bound for extreme outliers
    extreme_upper_bound = Q3 + 3 * IQR,  # Extreme upper bound for extreme outliers
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound,
    extreme_outlier_flag = daily_activity < extreme_lower_bound | daily_activity > extreme_upper_bound
  ) %>%
  ungroup() %>%
  summarize(
    outlier_count = sum(outlier_flag),
    extreme_outlier_count = sum(extreme_outlier_flag)
  )
```
Females t0 - 4 outliers, 1 extreme
Females t1 - 2 outliers, 1 extreme
Females t2 - 6 outliers, 2 extreme
Females t3 - 3 outliers, 3 extreme
Males t0 - 1 outliers
Males t1 - 0 outliers or extreme
Males t2 - 0 outliers or extreme
Males t3 - 1 outlier

# Remove all the outliers from all the groups with outliers for DGRP301
Note that males t1 and t2 did not have any outliers to remove
```{r}
females301_t0_outliers <- females301_t0 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

males301_t0_outliers <- males301_t0 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

females301_t1_outliers <- females301_t1 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

females301_t2_outliers <- females301_t2 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

females301_t3_outliers <- females301_t3 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

males301_t3_outliers <- males301_t3 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)
```
# Normality test on data with outliers removed for DGRP301
Change dataset as needed to check
```{r}
females301_t0_outliers %>%
  group_by(treatment) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
Mostly normal

# Convert treatment to factor for DGRP301
Remember that males t1 and t2 did not have any outliers to remove
```{r}
females301_t0_outliers$treatment <- as.factor(females301_t0_outliers$treatment)
males301_t0_outliers$treatment <- as.factor(males301_t0_outliers$treatment)
females301_t1_outliers$treatment <- as.factor(females301_t1_outliers$treatment)
males301_t1$treatment <- as.factor(males301_t1$treatment)
females301_t2_outliers$treatment <- as.factor(females301_t2_outliers$treatment)
males301_t2$treatment <- as.factor(males301_t2$treatment)
females301_t3_outliers$treatment <- as.factor(females301_t3_outliers$treatment)
males301_t3_outliers$treatment <- as.factor(males301_t3_outliers$treatment)
```
# Analysis with Type III ANOVA for females and males with outliers removed for DGRP301
```{r}
females301_t0_outliers_aov <- aov(daily_activity ~ treatment, data = females301_t0_outliers)
Anova(females301_t0_outliers_aov, type = 3)

males301_t0_outliers_aov <- aov(daily_activity ~ treatment, data = males301_t0_outliers)
Anova(males301_t0_outliers_aov, type = 3)

females301_t1_outliers_aov <- aov(daily_activity ~ treatment, data = females301_t1_outliers)
Anova(females301_t1_outliers_aov, type = 3)

males301_t1_aov <- aov(daily_activity ~ treatment, data = males301_t1)
Anova(males301_t1_aov, type = 3)

females301_t2_outliers_aov <- aov(daily_activity ~ treatment, data = females301_t2_outliers)
Anova(females301_t2_outliers_aov, type = 3)

males301_t2_aov <- aov(daily_activity ~ treatment, data = males301_t2)
Anova(males301_t2_aov, type = 3)

females301_t3_outliers_aov <- aov(daily_activity ~ treatment, data = females301_t3_outliers)
Anova(females301_t3_outliers_aov, type = 3)

males301_t3_outliers_aov <- aov(daily_activity ~ treatment, data = males301_t3_outliers)
Anova(males301_t3_outliers_aov, type = 3)
```
#adjust Anova for multiple testing
```{r}
p <- c(0.01909, 0.4983, 0.1363, 0.7387, 0.9349, 0.3735, 0.07445, 0.03601)
p.adjust(p, method = "fdr", n = length(p))
```
None significant

# Q-Q plot of residuals
Change the data name as needed to test
```{r}
QQ301_residuals <- resid(females301_t0_outliers_aov)
qqnorm(QQ301_residuals)
qqline(QQ301_residuals, col = "red")
```
#check normality no residuals
```{r}
shapiro.test(QQ301_residuals)
```

# Pairwise t-test with multiple corrections
None of the ANOVAs were significant




**DGRP304**
# Subset by Sex for Each Age for DGRP304
```{r}
females304_t0 <- master_t0_304 %>% filter(sex == "F")
males304_t0 <- master_t0_304 %>% filter(sex == "M")
females304_t1 <- master_t1_304 %>% filter(sex == "F")
males304_t1 <- master_t1_304 %>% filter(sex == "M")
females304_t2 <- master_t2_304 %>% filter(sex == "F")
males304_t2 <- master_t2_304 %>% filter(sex == "M")
females304_t3 <- master_t3_304 %>% filter(sex == "F")
males304_t3 <- master_t3_304 %>% filter(sex == "M")
```
# Kruskal-Wallis Tests on Treatment Factor Affecting Daily Activity for DGRP304
```{r}
kruskal.test(daily_activity ~ treatment, data = females304_t0)
kruskal.test(daily_activity ~ treatment, data = males304_t0)
kruskal.test(daily_activity ~ treatment, data = females304_t1)
kruskal.test(daily_activity ~ treatment, data = males304_t1)
kruskal.test(daily_activity ~ treatment, data = females304_t2)
kruskal.test(daily_activity ~ treatment, data = males304_t2)
kruskal.test(daily_activity ~ treatment, data = females304_t3)
kruskal.test(daily_activity ~ treatment, data = males304_t3)
```
#adjust KW for multiple testing
```{r}
p <- c(0.7122, 0.05163, 0.13, 0.1909, 0.0008254, 0.6792, 0.0276, 0.01424)
p.adjust(p, method = "fdr", n = length(p))
```
Females 304 t2 significant

# Shapiro-Wilk Normality Test for DGRP304
Change dataset name as needed to check all groups
```{r}
females304_t0 %>%
  group_by(treatment) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```

# Outlier and Extreme Outlier Detection for DGRP304
Change the dataset as needed to check
```{r}
females304_t0 %>%
  group_by(treatment, sex, age) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,  # Regular lower bound for outliers
    upper_bound = Q3 + 1.5 * IQR,  # Regular upper bound for outliers
    extreme_lower_bound = Q1 - 3 * IQR,  # Extreme lower bound for extreme outliers
    extreme_upper_bound = Q3 + 3 * IQR,  # Extreme upper bound for extreme outliers
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound,
    extreme_outlier_flag = daily_activity < extreme_lower_bound | daily_activity > extreme_upper_bound
  ) %>%
  ungroup() %>%
  summarize(
    outlier_count = sum(outlier_flag),
    extreme_outlier_count = sum(extreme_outlier_flag)
  )
```
Females t0 - 2 outliers
Females t1 - 4 outliers, 2 extreme
Females t2 - 3 outliers, 3 extreme
Females t3 - 3 outliers, 1 extreme
Males t0 - 1 outlier
Males t1 - 3 outliers, 1 extreme
Males t2 - 3 outliers
Males t3 - 6 outliers, 3 extreme


# Remove all the outliers from all the groups with outliers for DGRP304
```{r}
females304_t0_outliers <- females304_t0 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

males304_t0_outliers <- males304_t0 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

females304_t1_outliers <- females304_t1 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

males304_t1_outliers <- males304_t1 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

females304_t2_outliers <- females304_t2 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

males304_t2_outliers <- males304_t2 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

females304_t3_outliers <- females304_t3 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)

males304_t3_outliers <- males304_t3 %>%
  group_by(treatment) %>%
  mutate(
    Q1 = quantile(daily_activity, 0.25, na.rm = TRUE),
    Q3 = quantile(daily_activity, 0.75, na.rm = TRUE),
    IQR = Q3 - Q1,
    lower_bound = Q1 - 1.5 * IQR,
    upper_bound = Q3 + 1.5 * IQR,
    outlier_flag = daily_activity < lower_bound | daily_activity > upper_bound
  ) %>%
  ungroup() %>%
  filter(outlier_flag == FALSE) %>%
  select(-Q1, -Q3, -IQR, -lower_bound, -upper_bound)
```
# Normality test on data with outliers removed for DGRP304
Change dataset as needed to check all groups
```{r}
females304_t0_outliers %>%
  group_by(treatment) %>%
  shapiro_test(daily_activity) %>%
  subset(p < 0.05)
```
Mostly normal

# Convert treatment to factor for DGRP304
```{r}
females304_t0_outliers$treatment <- as.factor(females304_t0_outliers$treatment)
males304_t0_outliers$treatment <- as.factor(males304_t0_outliers$treatment)
females304_t1_outliers$treatment <- as.factor(females304_t1_outliers$treatment)
males304_t1_outliers$treatment <- as.factor(males304_t1_outliers$treatment)
females304_t2_outliers$treatment <- as.factor(females304_t2_outliers$treatment)
males304_t2_outliers$treatment <- as.factor(males304_t2_outliers$treatment)
females304_t3_outliers$treatment <- as.factor(females304_t3_outliers$treatment)
males304_t3_outliers$treatment <- as.factor(males304_t3_outliers$treatment)
```

# Analysis with Type III ANOVA for females and males with outliers removed for DGRP304
```{r}
females304_t0_outliers_aov <- aov(daily_activity ~ treatment, data = females304_t0_outliers)
Anova(females304_t0_outliers_aov, type = 3)

males304_t0_outliers_aov <- aov(daily_activity ~ treatment, data = males304_t0_outliers)
Anova(males304_t0_outliers_aov, type = 3)

females304_t1_outliers_aov <- aov(daily_activity ~ treatment, data = females304_t1_outliers)
Anova(females304_t1_outliers_aov, type = 3)

males304_t1_outliers_aov <- aov(daily_activity ~ treatment, data = males304_t1_outliers)
Anova(males304_t1_outliers_aov, type = 3)

females304_t2_outliers_aov <- aov(daily_activity ~ treatment, data = females304_t2_outliers)
Anova(females304_t2_outliers_aov, type = 3)

males304_t2_outliers_aov <- aov(daily_activity ~ treatment, data = males304_t2_outliers)
Anova(males304_t2_outliers_aov, type = 3)

females304_t3_outliers_aov <- aov(daily_activity ~ treatment, data = females304_t3_outliers)
Anova(females304_t3_outliers_aov, type = 3)

males304_t3_outliers_aov <- aov(daily_activity ~ treatment, data = males304_t3_outliers)
Anova(males304_t3_outliers_aov, type = 3)
```
#adjust Anova for multiple testing
```{r}
p <- c(0.6395, 0.01004, 0.01233, 0.05538, 0.0001705, 0.2644, 0.002903, 0.0007212)
p.adjust(p, method = "fdr", n = length(p))
```
Males 304 t0, Females 304 t1, Females 304 t2, Females 304 t3, Males 304 t3

# Q-Q plot of residuals
Change the data name as needed to test
```{r}
QQ304_residuals <- resid(males304_t1_outliers_aov)
qqnorm(QQ304_residuals)
qqline(QQ304_residuals, col = "red")
```
#check normality no residuals
```{r}
shapiro.test(QQ304_residuals)
```

# Pairwise t-test with multiple corrections
Performed on data with outliers removed
```{r}
pairwise_males_t0 <- pairwise.t.test(males304_t0_outliers$daily_activity, males304_t0_outliers$treatment)
print(pairwise_males_t0)

pairwise_females_t1 <- pairwise.t.test(females304_t1_outliers$daily_activity, females304_t1_outliers$treatment, p.adjust.method = "bonferroni")
print(pairwise_females_t1)

pairwise_females_t2 <- pairwise.t.test(females304_t2_outliers$daily_activity, females304_t2_outliers$treatment, p.adjust.method = "bonferroni")
print(pairwise_females_t2)

pairwise_females_t3 <- pairwise.t.test(females304_t3_outliers$daily_activity, females304_t3_outliers$treatment, p.adjust.method = "bonferroni")
print(pairwise_females_t3)

pairwise_males_t3 <- pairwise.t.test(males304_t3_outliers$daily_activity, males304_t3_outliers$treatment, p.adjust.method = "bonferroni")
print(pairwise_males_t3)
```
Males t0 c-5d, t3 c-20d and 5d-20d
Females t1 5d-20d, t2 c-20d and 5d-20d, t3 c-20d and 5d-20d


#create a boxplot unscaled for Figure 2
This compares activity across age for each genotype
#order the treatments to appear as c, 5d, 20d for DGRP301
```{r}
master_301_outliers$treatment <- factor(master_301_outliers$treatment,
                                        levels = c("c", "5d", "20d"))
```
#boxplot of 301, unscaled
```{r}
boxplot_301 <- ggplot(data = master_301_outliers %>%
         mutate(treatment = factor(treatment, levels = c("c", "5d", "20d"))),
       aes(x = sex, y = daily_activity)) +
  geom_boxplot(aes(fill = "white", color = treatment), outlier.shape = NA, size=0.75) +
  geom_jitter(aes(x = sex, y = daily_activity, color = treatment), 
              alpha = 0.6, 
              position = position_jitterdodge(jitter.width = 0.2, jitter.height = 0), 
              size = 1) + 
  facet_grid(~genotype~age) +
  scale_fill_manual(values = "white") + 
  scale_color_manual(values = c("#FF4433","#EFC000FF","#0073C2FF"),
                     labels = c("Control", "5-day", "20-day")) +
  labs(x = "Sex", y = "Total Activity per fly", fill = "Treatment", color = "Treatment") +
  theme_bw() +
  theme(strip.background = element_rect(fill = "white"), 
        strip.text = element_text(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) 

boxplot_301

```
#order the treatments to appear as c, 5d, 20d for DGRP301
```{r}
master_304_outliers$treatment <- factor(master_304_outliers$treatment,
                                        levels = c("c", "5d", "20d"))
```
#boxplot of 304, unscaled
```{r}
boxplot_304 <- ggplot(data = master_304_outliers %>%
         mutate(treatment = factor(treatment, levels = c("c", "5d", "20d"))),
       aes(x = sex, y = daily_activity)) +
  geom_boxplot(aes(fill = "white", color = treatment), outlier.shape = NA, size=0.75) +
  geom_jitter(aes(x = sex, y = daily_activity, color = treatment), 
              alpha = 0.6, 
              position = position_jitterdodge(jitter.width = 0.2, jitter.height = 0), 
              size = 1) + 
  facet_grid(~genotype~age) +
  scale_fill_manual(values = "white") + 
  scale_color_manual(values = c("#FF4433","#EFC000FF","#0073C2FF"),
                     labels = c("Control", "5-day", "20-day")) +
  labs(x = "Sex", y = "Total Activity per fly", fill = "Treatment", color = "Treatment") +
  theme_bw() +
  theme(strip.background = element_rect(fill = "white"), 
        strip.text = element_text(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) 

boxplot_304

```
#order the treatments to appear as c, 5d, 20d for DGRP786
```{r}
master_786_outliers$treatment <- factor(master_786_outliers$treatment,
                                        levels = c("c", "5d", "20d"))
```
#boxplot of 786, unscaled
```{r}
boxplot_786 <- ggplot(data = master_786_outliers %>%
         mutate(treatment = factor(treatment, levels = c("c", "5d", "20d"))),
       aes(x = sex, y = daily_activity)) +
  geom_boxplot(aes(fill = "white", color = treatment), outlier.shape = NA, size=0.75) +
  geom_jitter(aes(x = sex, y = daily_activity, color = treatment), 
              alpha = 0.6, 
              position = position_jitterdodge(jitter.width = 0.2, jitter.height = 0), 
              size = 1) + 
  facet_grid(~genotype~age) +
  scale_fill_manual(values = "white") + 
  scale_color_manual(values = c("#FF4433","#EFC000FF","#0073C2FF"),
                     labels = c("Control", "5-day", "20-day")) +
  labs(x = "Sex", y = "Total Activity per fly", fill = "Treatment", color = "Treatment") +
  theme_bw() +
  theme(strip.background = element_rect(fill = "white"), 
        strip.text = element_text(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) 

boxplot_786

```

#order the treatments to appear as c, 5d, 20d and create a blank 4th box for the missing age for DGRP852
There is no t3 timepoint for DGRP852 because the data was censored out
```{r}
master_852_outliers$treatment <- factor(master_852_outliers$treatment,
                                        levels = c("c", "5d", "20d"))
master_852_outliers$age <- factor(master_852_outliers$age,
                                  levels = c("11", "26", "37", "missing"))

```
#boxplot of 852, unscaled
```{r}

boxplot_852 <- ggplot(data = master_852_outliers %>%
         mutate(treatment = factor(treatment, levels = c("c", "5d", "20d"))),
       aes(x = sex, y = daily_activity)) +
  geom_boxplot(aes(fill = "white", color = treatment), outlier.shape = NA, size=0.75) +
  geom_jitter(aes(x = sex, y = daily_activity, color = treatment), 
              alpha = 0.6, 
              position = position_jitterdodge(jitter.width = 0.2, jitter.height = 0), 
              size = 1) + 
  facet_grid(~genotype~age, drop = FALSE) +  # ensure it doesn't drop unused levels
  scale_fill_manual(values = "white") + 
  scale_color_manual(values = c("#FF4433","#EFC000FF","#0073C2FF"),
                     labels = c("Control", "5-day", "20-day")) +
  labs(x = "Sex", y = "Total Activity per fly", fill = "Treatment", color = "Treatment") +
  theme_bw() +
  theme(strip.background = element_rect(fill = "white"), 
        strip.text = element_text(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) 

boxplot_852
```



